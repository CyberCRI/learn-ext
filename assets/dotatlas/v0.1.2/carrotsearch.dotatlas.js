/**
 * Carrot Search dotAtlas (pre-release, demo)
 * v0.1.2, master/8cff0b3, build DOTATLAS-SOFTWARE-29, 2019-01-28
 *
 * Carrot Search confidential.
 * Copyright 2002-2019, Carrot Search s.c, All Rights Reserved.
 */
(function(){
'use strict';var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},E="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function F(){F=function(){};E.Symbol||(E.Symbol=ca)}var da=0;function ca(a){return"jscomp_symbol_"+(a||"")+da++}
function H(){F();var a=E.Symbol.iterator;a||(a=E.Symbol.iterator=E.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&aa(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return ea(this)}});H=function(){}}function ea(a){var b=0;return fa(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})}function fa(a){H();a={next:a};a[E.Symbol.iterator]=function(){return this};return a}function J(a){H();F();H();var b=a[Symbol.iterator];return b?b.call(a):ea(a)}
function K(a,b){if(b){var c=E;a=a.split(".");for(var f=0;f<a.length-1;f++){var e=a[f];e in c||(c[e]={});c=c[e]}a=a[a.length-1];f=c[a];b=b(f);b!=f&&null!=b&&aa(c,a,{configurable:!0,writable:!0,value:b})}}function L(a,b){return Object.prototype.hasOwnProperty.call(a,b)}K("Object.assign",function(a){return a?a:function(a,c){for(var b=1;b<arguments.length;b++){var e=arguments[b];if(e)for(var h in e)L(e,h)&&(a[h]=e[h])}return a}});
K("WeakMap",function(a){function b(a){this.a=(h+=Math.random()+1).toString();if(a){F();H();a=J(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}}function c(a){L(a,e)||aa(a,e,{value:{}})}function f(a){var b=Object[a];b&&(Object[a]=function(a){c(a);return b(a)})}if(function(){if(!a||!Object.seal)return!1;try{var b=Object.seal({}),d=Object.seal({}),c=new a([[b,2],[d,3]]);if(2!=c.get(b)||3!=c.get(d))return!1;c.delete(b);c.set(d,4);return!c.has(b)&&4==c.get(d)}catch(l){return!1}}())return a;
var e="$jscomp_hidden_"+Math.random().toString().substring(2);f("freeze");f("preventExtensions");f("seal");var h=0;b.prototype.set=function(a,b){c(a);if(!L(a,e))throw Error("WeakMap key fail: "+a);a[e][this.a]=b;return this};b.prototype.get=function(a){return L(a,e)?a[e][this.a]:void 0};b.prototype.has=function(a){return L(a,e)&&L(a[e],this.a)};b.prototype.delete=function(a){return L(a,e)&&L(a[e],this.a)?delete a[e][this.a]:!1};return b});
K("Map",function(a){function b(){var a={};return a.aa=a.next=a.head=a}function c(a,b){var d=a.a;return fa(function(){if(d){for(;d.head!=a.a;)d=d.aa;for(;d.next!=d.head;)return d=d.next,{done:!1,value:b(d)};d=null}return{done:!0,value:void 0}})}function f(a,b){var d=b&&typeof b;"object"==d||"function"==d?h.has(b)?d=h.get(b):(d=""+ ++k,h.set(b,d)):d="p_"+b;var c=a.b[d];if(c&&L(a.b,d))for(a=0;a<c.length;a++){var g=c[a];if(b!==b&&g.key!==g.key||b===g.key)return{id:d,list:c,index:a,H:g}}return{id:d,list:c,
index:-1,H:void 0}}function e(a){this.b={};this.a=b();this.size=0;if(a){a=J(a);for(var d;!(d=a.next()).done;)d=d.value,this.set(d[0],d[1])}}if(function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),c=new a(J([[b,"s"]]));if("s"!=c.get(b)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var e=c.entries(),f=e.next();if(f.done||f.value[0]!=b||"s"!=f.value[1])return!1;f=e.next();return f.done||4!=f.value[0].x||"t"!=f.value[1]||!e.next().done?
!1:!0}catch(g){return!1}}())return a;F();H();var h=new WeakMap;e.prototype.set=function(a,b){var d=f(this,a);d.list||(d.list=this.b[d.id]=[]);d.H?d.H.value=b:(d.H={next:this.a,aa:this.a.aa,head:this.a,key:a,value:b},d.list.push(d.H),this.a.aa.next=d.H,this.a.aa=d.H,this.size++);return this};e.prototype.delete=function(a){a=f(this,a);return a.H&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.b[a.id],a.H.aa.next=a.H.next,a.H.next.aa=a.H.aa,a.H.head=null,this.size--,!0):!1};e.prototype.clear=
function(){this.b={};this.a=this.a.aa=b();this.size=0};e.prototype.has=function(a){return!!f(this,a).H};e.prototype.get=function(a){return(a=f(this,a).H)&&a.value};e.prototype.entries=function(){return c(this,function(a){return[a.key,a.value]})};e.prototype.keys=function(){return c(this,function(a){return a.key})};e.prototype.values=function(){return c(this,function(a){return a.value})};e.prototype.forEach=function(a,b){for(var d=this.entries(),c;!(c=d.next()).done;)c=c.value,a.call(b,c[1],c[0],this)};
e.prototype[Symbol.iterator]=e.prototype.entries;var k=0;return e});K("Array.from",function(a){return a?a:function(a,c,f){H();c=c?c:function(a){return a};var b=[],h=a[Symbol.iterator];if("function"==typeof h)for(a=h.call(a);!(h=a.next()).done;)b.push(c.call(f,h.value));else{h=a.length;for(var k=0;k<h;k++)b.push(c.call(f,a[k]))}return b}});
K("Set",function(a){function b(a){this.a=new Map;if(a){a=J(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.a.size}if(function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var b=Object.seal({x:4}),f=new a(J([b]));if(!f.has(b)||1!=f.size||f.add(b)!=f||1!=f.size||f.add({x:4})!=f||2!=f.size)return!1;var e=f.entries(),h=e.next();if(h.done||h.value[0]!=b||h.value[1]!=b)return!1;h=e.next();return h.done||h.value[0]==b||4!=h.value[0].x||h.value[1]!=h.value[0]?
!1:e.next().done}catch(k){return!1}}())return a;F();H();b.prototype.add=function(a){this.a.set(a,a);this.size=this.a.size;return this};b.prototype.delete=function(a){a=this.a.delete(a);this.size=this.a.size;return a};b.prototype.clear=function(){this.a.clear();this.size=0};b.prototype.has=function(a){return this.a.has(a)};b.prototype.entries=function(){return this.a.entries()};b.prototype.values=function(){return this.a.values()};b.prototype.keys=b.prototype.values;b.prototype[Symbol.iterator]=b.prototype.values;
b.prototype.forEach=function(a,b){var c=this;this.a.forEach(function(f){return a.call(b,f,f,c)})};return b});
K("Promise",function(a){function b(a){this.b=0;this.i=void 0;this.a=[];var b=this.c();try{a(b.resolve,b.reject)}catch(m){b.reject(m)}}function c(){this.a=null}function f(a){return a instanceof b?a:new b(function(b){b(a)})}if(a)return a;c.prototype.b=function(a){this.a||(this.a=[],this.h());this.a.push(a)};c.prototype.h=function(){var a=this;this.c(function(){a.o()})};var e=E.setTimeout;c.prototype.c=function(a){e(a,0)};c.prototype.o=function(){for(;this.a&&this.a.length;){var a=this.a;this.a=[];for(var b=
0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(l){this.i(l)}}}this.a=null};c.prototype.i=function(a){this.c(function(){throw a;})};b.prototype.c=function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=!1;return{resolve:a(this.R),reject:a(this.h)}};b.prototype.R=function(a){if(a===this)this.h(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof b)this.S(a);else{a:switch(typeof a){case "object":var d=null!=a;break a;case "function":d=!0;break a;default:d=
!1}d?this.P(a):this.o(a)}};b.prototype.P=function(a){var b=void 0;try{b=a.then}catch(m){this.h(m);return}"function"==typeof b?this.V(b,a):this.o(a)};b.prototype.h=function(a){this.J(2,a)};b.prototype.o=function(a){this.J(1,a)};b.prototype.J=function(a,b){if(0!=this.b)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.b);this.b=a;this.i=b;this.L()};b.prototype.L=function(){if(this.a){for(var a=this.a,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.a=null}};var h=new c;b.prototype.S=
function(a){var b=this.c();a.pa(b.resolve,b.reject)};b.prototype.V=function(a,b){var c=this.c();try{a.call(b,c.resolve,c.reject)}catch(l){c.reject(l)}};b.prototype.then=function(a,c){function d(a,b){return"function"==typeof a?function(b){try{f(a(b))}catch(u){e(u)}}:b}var f,e,g=new b(function(a,b){f=a;e=b});this.pa(d(a,f),d(c,e));return g};b.prototype.catch=function(a){return this.then(void 0,a)};b.prototype.pa=function(a,b){function c(){switch(d.b){case 1:a(d.i);break;case 2:b(d.i);break;default:throw Error("Unexpected state: "+
d.b);}}var d=this;this.a?this.a.push(function(){h.b(c)}):h.b(c)};b.resolve=f;b.reject=function(a){return new b(function(b,c){c(a)})};b.race=function(a){return new b(function(b,c){for(var d=J(a),e=d.next();!e.done;e=d.next())f(e.value).pa(b,c)})};b.all=function(a){var c=J(a),e=c.next();return e.done?f([]):new b(function(a,b){function g(b){return function(g){d[b]=g;h--;h||a(d)}}var d=[],h=0;do d.push(void 0),h++,f(e.value).pa(g(d.length-1),b),e=c.next();while(!e.done)})};return b});
K("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991});K("Array.prototype.fill",function(a){return a?a:function(a,c,f){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==f||f>b)f=b;f=Number(f);0>f&&(f=Math.max(0,b+f));for(c=Number(c||0);c<f;c++)this[c]=a;return this}});function ia(a,b,c,f){function e(a,g){f.options.hasOwnProperty(a)?f.options[a].set.call(b,g):f.ra.hasOwnProperty(a)&&d(a,g||[])}function h(a,b){p.has(a)&&(a=p.get(a),Array.isArray(p)?a.push.apply(a,b.filter(function(a){return!!a})):a.push(b),m())}function k(a,b){if(p.has(a)){if(Array.isArray(b)){var g=new Set(b);var c=function(a){return!g.has(a)}}else c=function(a){return a!==b};p.set(a,p.get(a).filter(c));m()}}function d(a,b){p.has(a)&&(Array.isArray(b)?p.set(a,b.filter(function(a){return!!a})):p.set(a,
[b]),m())}function m(){for(var c={},d=J(g),e=d.next();!e.done;c={event:c.event},e=d.next()){e=J(e.value);c.event=e.next().value;e=e.next().value;var h=p.get(c.event),l=f.ra[c.event];0===e&&0<h.length?l.call(b,function(b){return function(){var g=arguments;p.get(b.event).forEach(function(b){b&&b.apply(a,g)})}}(c)):0<e&&0===h.length&&l.call(b,void 0);g.set(c.event,h.length)}}Object.freeze(Object.keys(f.options).reduce(function(a,g){a[g]=f.options[g].get.call(b);return a},{}));var l=Object.assign({},
f.options,f.Mb),p=Object.keys(f.ra).reduce(function(a,b){a.set(b,[]);return a},new Map),g=Object.keys(f.ra).reduce(function(a,b){a.set(b,0);return a},new Map);c&&Object.keys(c).forEach(function(a){e(a,c[a])});Object.keys(f.methods).forEach(function(g){a[g]=function(){return f.methods[g].apply(b,arguments)}});a.set=function(a,b){a&&a.constructor===Object?Object.keys(a).forEach(function(b){e(b,a[b])}):e(a,b)};a.get=function(a){if(l.hasOwnProperty(a))return l[a].get.apply(b,Array.from(arguments).slice(1))};
a.on=function(a,b){b&&h("on"+a.charAt(0).toUpperCase()+a.substring(1),b)};a.off=function(a,b){b&&k("on"+a.charAt(0).toUpperCase()+a.substring(1),b)}};try{window.localStorage.setItem("ftap5caavc","ftap5caavc"),window.localStorage.removeItem("ftap5caavc")}catch(a){};function ma(){var a=document,b={};this.addEventListener=function(c,f){var e=b[c];e||(e=[],b[c]=e);e.push(f);a.addEventListener(c,f)}};function oa(a){function b(a){return function(b){c(b)&&a.apply(this,arguments)}}function c(b){for(b=b.target;b;){if(b===a)return!0;b=b.parentElement}return!1}function f(a,b,g){g=g||{};e(a,g);for(var c=0;c<b.length;c++)b[c].call(a.target,g);(void 0===g.originalEventDefaultAction&&g.Zb||"prevent"===g.originalEventDefaultAction)&&a.preventDefault();return g}function e(b,g){var c=b.clientX,d=b.clientY,e=g||{},f=a.getBoundingClientRect();e.x=c-f.left;e.y=d-f.top;g.altKey=b.altKey;g.metaKey=b.metaKey;g.ctrlKey=
b.ctrlKey;g.shiftKey=b.shiftKey;g.gc=3===b.which;return g}function h(a,b){var g=a.x-b.x;a=a.y-b.y;return g*g+a*a}var k=new ma,d=[],m=[],l=[],p=[],g=[],q=[],n=[],r=[],u=[],t=[];this.click=function(a){d.push(a)};this.ub=function(a){p.push(a)};this.bc=function(a){t.push(a)};this.move=function(a){g.push(a)};this.Yb=function(a){q.push(a)};this.xb=function(a){n.push(a)};this.vb=function(a){r.push(a)};this.wb=function(a){u.push(a)};var y,v,z,x,w=!1,A=!1,B={x:0,y:0},C={x:0,y:0};k.addEventListener("mousedown",
b(function(a){var b=f(a,l);C.x=b.x;C.y=b.y;B.x=b.x;B.y=b.y;w=!0;f(a,n);v=!1;y=window.setTimeout(function(){100>h(B,b)&&(window.clearTimeout(x),f(a,m),v=!0)},400)}));k.addEventListener("mouseup",function(a){function b(a){var b={};b.x=a.pageX;b.y=a.pageY;return b}if(w){A&&f(a,u);window.clearTimeout(y);if(!v&&!A&&c(a)){var g=b(a);z&&100>h(g,z)?f(a,p):f(a,d);z=g;x=window.setTimeout(function(){z=null},350)}A=w=!1}});k.addEventListener("mousemove",function(a){var b=e(a,{});c(a)&&f(a,g,{type:"move"});B.x=
b.x;B.y=b.y;w&&!A&&100<h(C,B)&&(A=!0);A&&f(a,r,b)});k.addEventListener("mouseout",b(function(a){f(a,q,{type:"out"})}));k.addEventListener("wheel",b(function(){return function(a){if("deltaY"in a)var b=a.deltaY;else b=0,"detail"in a&&(b=a.detail),"wheelDelta"in a&&(b=-a.wheelDelta/120),"wheelDeltaY"in a&&(b=-a.wheelDeltaY/120),"axis"in a&&a.axis===a.HORIZONTAL_AXIS&&(b=0),b*=10;b&&a.deltaMode&&(b=1===a.deltaMode?67*b:800*b);f(a,t,{ma:-b/200,Zb:!0})}}()));k.addEventListener("contextmenu",b(function(a){a.preventDefault()}))}
;function O(a,b,c,f){this.x=a;this.y=b;this.F=c;this.I=f;this.ab=function(){return Math.sqrt(this.F*this.F+this.I*this.I)};this.Xb=function(){return this.hb(.05*this.ab())};this.hb=function(a){return new O(this.x-a,this.y-a,this.F+2*a,this.I+2*a)};this.Va=function(a){if(this.F/this.I<a)return a=this.I*a-this.F,new O(this.x-a/2,this.y,this.F+a,this.I);a=this.F/a-this.I;return new O(this.x,this.y-a/2,this.F,this.I+a)}}
function va(a){if(0!==a.length){var b,c=a[0],f=c.x,e=c.y,h=c.x,k=c.y;for(b=1;b<a.length;b++)c=a[b],f>c.x?f=c.x:h<c.x&&(h=c.x),e>c.y?e=c.y:k<c.y&&(k=c.y);return new O(f,e,h-f,k-e)}};function wa(a){function b(a,b){var g=d.createRenderbuffer();d.bindRenderbuffer(d.RENDERBUFFER,g);d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_COMPONENT16,a,b);this.use=function(a){d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,g);a.call(this);d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,null)};this.release=function(){d.deleteRenderbuffer(g)}}function c(){var a=d.createFramebuffer();this.use=function(b){d.bindFramebuffer(d.FRAMEBUFFER,a);b.call(this);
d.bindFramebuffer(d.FRAMEBUFFER,null)};this.release=function(){d.deleteFramebuffer(a)}}function f(a){this.use=function(b,c){d.activeTexture(d.TEXTURE0+b);d.bindTexture(d.TEXTURE_2D,a);c.call(this)};this.W=function(){return a};this.release=function(){d.deleteTexture(a)}}function e(){var a=d.createBuffer(),b,c;this.release=function(){d.deleteBuffer(a)};this.bind=function(g){d.bindBuffer(d.ARRAY_BUFFER,a);g.call(this,b,c);d.bindBuffer(d.ARRAY_BUFFER,null)};this.setData=function(a,g,f){b=g;c=f;this.bind(function(){d.bufferData(d.ARRAY_BUFFER,
a,d.STATIC_DRAW)})};this.m=function(){return c}}function h(a,b,c,f,e){function g(a){var b=q[a];if(void 0===b)throw"Unknown attribute "+a+".";return b}function h(a){var b=r[a];if(void 0===b)throw"Unknown uniform  "+a+".";return b}function k(b,g){g=d.createShader(g);d.shaderSource(g,b);d.compileShader(g);if(!d.getShaderParameter(g,d.COMPILE_STATUS))throw"Shader in program '"+a+"' failed to compile: "+d.getShaderInfoLog(g)+".";return g}var p=k(b,d.VERTEX_SHADER),m=k(c,d.FRAGMENT_SHADER),n=d.createProgram();
d.attachShader(n,p);d.attachShader(n,m);d.linkProgram(n);if(!d.getProgramParameter(n,d.LINK_STATUS))throw"Could not link program '"+a+"'.";var q=f.reduce(function(b,g){var c=d.getAttribLocation(n,g);if(0>c)throw"Failed to find location of attribute "+g+" in program "+a;b[g]=c;return b},{}),r=e.reduce(function(b,g){var c=d.getUniformLocation(n,g);if(0>c)throw"Failed to find location of uniform "+g+" in program "+a;b[g]=c;return b},{});this.G=function(a){a=J(a);for(var b=a.next();!b.done;b=a.next())d.enableVertexAttribArray(g(b.value))};
this.use=function(a){d.useProgram(n);a.call(this);d.useProgram(null)};this.g=function(a,b,c,f,e,h,k){c=void 0===c?d.FLOAT:c;f=void 0===f?!1:f;e=void 0===e?0:e;h=void 0===h?0:h;k=void 0===k?!1:k;b.bind(function(b){var p=g(a);d.vertexAttribPointer(p,b,c,f,e,h);k?l.vertexAttribDivisorANGLE(p,1):l.vertexAttribDivisorANGLE(p,0)})};this.f=function(a,b){d.uniform1f(h(a),b)};this.D=function(a,b,g){d.uniform2f(h(a),b,g)};this.ac=function(a,b,g){d.uniform3f(h("uLight"),a,b,g)};this.jb=function(a,b){var g=1/
255;d.uniform4f(h(a),b[0]*g,b[1]*g,b[2]*g,b[3]*g)};this.ga=function(a){d.uniformMatrix3fv(h("uMvMatrix"),!1,a)};this.v=function(a,b,g){b.use(g,function(){d.uniform1i(h(a),g)})};this.qa=function(a,b){l.drawArraysInstancedANGLE(d.TRIANGLE_FAN,0,void 0===b?0:b,a)};this.Y=function(a){d.drawArrays(d.TRIANGLE_STRIP,0,a)};this.bb=function(a){d.drawArrays(d.POINTS,0,a)};this.release=function(){d.deleteShader(p);d.deleteShader(m);d.deleteProgram(n)}}var k=Object.assign({cb:[]},{cb:xa}),d=a.getContext("webgl");
d||(d=a.getContext("experimental-webgl"));if(!d)throw"DotAtlas requires WebGL support";k=J(k.cb);for(var m=k.next();!m.done;m=k.next())if(m=m.value,!d.getExtension(m))throw"WebGL extension "+m+" is not supported.";var l=d.getExtension("ANGLE_instanced_arrays");if(!l)throw"WebGL extension ANGLE_instanced_arrays is required.";d.getExtension("EXT_disjoint_timer_query");this.Z=d;this.canvas=a;this.createProgram=function(a){return new h(a.name,a.T,a.N,void 0===a.K?[]:a.K,void 0===a.M?[]:a.M)};this.createBuffer=
function(){return new e};this.da=function(){var a=this.createBuffer();a.setData(new Float32Array([-1,1,1,1,-1,-1,1,-1]),2,4);return a};this.createTexture=function(a,b,c,e,h,l){h=void 0===h?d.RGBA:h;l=void 0===l?d.FLOAT:l;return f.a(a,b,c,e,h,l)};this.Pa=function(a,b,c,e){c=void 0===c?d.RGBA:c;e=void 0===e?d.UNSIGNED_BYTE:e;return f.Pa(a,b,c,e)};this.createFramebuffer=function(){return new c};this.sb=function(a,g){return new b(a,g)};f.a=function(a,b,c,e,h,l){h=void 0===h?d.RGBA:h;l=void 0===l?d.FLOAT:
l;var g=d.createTexture();d.bindTexture(d.TEXTURE_2D,g);d.texImage2D(d.TEXTURE_2D,0,h,b,c,0,h,l,a);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,e);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);return new f(g)};f.Pa=function(a,b,c,e){c=void 0===c?d.RGBA:c;e=void 0===e?d.UNSIGNED_BYTE:e;var g=d.createTexture();d.bindTexture(d.TEXTURE_2D,g);d.texImage2D(d.TEXTURE_2D,
0,c,c,e,a);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,b);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,b);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);return new f(g)}};function ya(){function a(e){function h(a,b){for(k=0;k<a.length;k++){d=a[k];var g=window.performance.now();g<m&&d(e,g,m)||b.push(d)}}f=!1;var k,d,m=window.performance.now()+12,l=b,p=c;b=[];c=[];h(l,b);h(p,c);(0<b.length||0<c.length)&&!f&&(requestAnimationFrame(a),f=!0)}var b=[],c=[],f=!1;this.Xa=function(c){b.push(c);f||(requestAnimationFrame(a),f=!0)}};var za="function"===typeof Float32Array;function Ba(a,b,c){return(((1-3*c+3*b)*a+(3*c-6*b))*a+3*b)*a}
function Ca(a,b,c){if(!(0<=a&&1>=a&&0<=c&&1>=c))throw Error("bezier x values must be in [0, 1] range");var f=za?new Float32Array(11):Array(11);if(a!==b||1!==c)for(var e=0;11>e;++e)f[e]=Ba(.1*e,a,c);return function(e){if(a!==b||1!==c)if(0===e)e=0;else if(1===e)e=1;else{for(var h=0,d=1;10!==d&&f[d]<=e;++d)h+=.1;--d;d=h+(e-f[d])/(f[d+1]-f[d])*.1;var m=3*(1-3*c+3*a)*d*d+2*(3*c-6*a)*d+3*a;if(.001<=m){for(h=0;4>h;++h){m=3*(1-3*c+3*a)*d*d+2*(3*c-6*a)*d+3*a;if(0===m)break;d-=(Ba(d,a,c)-e)/m}e=d}else if(0===
m)e=d;else{d=h;h+=.1;var l=0;do{var p=d+(h-d)/2;m=Ba(p,a,c)-e;0<m?h=p:d=p}while(1E-7<Math.abs(m)&&10>++l);e=p}e=Ba(e,b,1)}return e}};function P(a,b){return void 0!==a?a:b};function Da(a,b){function c(a){for(var b={},g=0;g<l.length;g++){var c=l[g];b[c]=a[c]}return b}var f=Ca(.25,.1,.25),e=a.duration,h=a.step,k=a.complete,d,m=!1,l,p,g,q;this.a=function(a){l=Object.keys(a);g=c(a);p=c(a)};this.start=function(a,r){a&&(q=c(a));a=!0;for(var n=0;n<l.length;n++){var t=l[n];if(g[t]!==q[t]){a=!1;break}}a||(d=window.performance.now(),m||(m=!0,b.Xa(function(a){a=f(Math.max(0,Math.min(1,(a-d)/P(r,e))));for(var b=0;b<l.length;b++){var c=l[b],n=g[c];p[c]=n+a*(q[c]-n)}h(p,a);if(1>a)return!1;
k&&k(p);m=!1;return!0})))}};function Fa(a,b){function c(a,b,g,c){a.j=(a.j-b)*c+b;a.l=(a.l-g)*c+g;a.scale*=c}function f(a,b,g){e.j=a;e.l=b;e.scale=g;h.j=a;h.l=b;h.scale=g}var e={j:a.$.j,l:a.$.l,scale:a.$.scale},h={j:a.$.j,l:a.$.l,scale:a.$.scale},k=a.$b,d=new Da({duration:450,step:function(a){e.j=a.j;e.l=a.l;e.scale=a.scale;k.setTransform(e.j,e.l,e.scale)},complete:function(){k.ca()}},b);this.ca=function(){k.setTransform(e.j,e.l,e.scale)};this.Za=function(a,b,g){d.a(e);c(h,a,b,g);d.start(h)};this.nb=function(a,b,g){d.a(e);var f=
Math.log(h.scale)/Math.log(2);c(h,a,b,Math.pow(2,.25*(0<g?Math.ceil(f/.25):Math.floor(f/.25)))/h.scale);d.start(h,250)};this.c=function(a,b,g,c){d.a(e);h.j=a;h.l=b;h.scale=g;d.start(h,c)};var m;this.Oa=function(a,b,g){c(e,a,b,g);h.j=e.j;h.l=e.l;h.scale=e.scale;k.setTransform(e.j,e.l,e.scale);window.clearTimeout(m);m=window.setTimeout(function(){k.ca()},300)};this.ib=function(a,b){if(0!==a||0!==b)e.j+=a,e.l+=b,h.j+=a,h.l+=b,k.setTransform(e.j,e.l,e.scale),window.clearTimeout(m),m=window.setTimeout(function(){k.ca()},
300)};this.reset=function(b){d.a(e);h.j=a.$.j;h.l=a.$.l;h.scale=a.$.scale;d.start(h,b)};this.a=function(a,b,g,c,d,h,k){if(a-g||b-c){c=e.j;var l=e.l;b=e.scale;g/=k*h.F;a/=k*d.F;1===b?(d=a/g,c*=d,l*=d):(c=(c/(1-b)/g+h.x-d.x)*a,d=(l/(1-b)/g+h.y-d.y)*a,c=-c*b+c,l=-d*b+d);f(c,l,b)}};this.setTransform=f;this.b=function(){return e}};function Ga(a,b,c){function f(){}var e=Math.pow(2,.5),h=f,k;b.bc(function(b){var g=!1;!1===h({x:b.x,y:b.y,delta:b.ma,ctrlKey:b.ctrlKey,shiftKey:b.shiftKey,altKey:b.altKey,preventDefault:function(){g=!0}})||g||(1<=Math.abs(b.ma)?a.Za(b.x,b.y,0<b.ma?e:1/e):(a.Oa(b.x,b.y,Math.pow(2,b.ma/2)),window.clearTimeout(k),k=window.setTimeout(function(){a.nb(b.x,b.y,b.ma)},50)))});b.ub(function(b){var g=2*(b.altKey?1:2);a.Za(b.x,b.y,b.ctrlKey?1/g:g)});document.addEventListener("keydown",function(b){27===b.keyCode&&
a.reset()});var d,m,l=!1,p,g,q,n,r=!1,u=1,t;b.xb(function(a){d=a.x;m=a.y;p=a.x;g=a.y;l=!0});b.vb(function(b){l&&(q=b.x,n=b.y,r||(r=!0,c.Xa(function(){if(b.shiftKey){var c=q-p,e=n-g;c=Math.max(10,Math.sqrt(c*c+e*e));t?b.ctrlKey?(c=t/c,e=c/u,u=c,a.Oa(q,n,e)):(c/=t,e=c/u,u=c,a.Oa(p,g,e)):t=c}else a.ib(q-d,n-m);d=q;m=n;r=!1;return!0})))});b.wb(function(b){t=void 0;b.shiftKey?u=1:c.Xa(function(){a.ib(b.x-d,b.y-m);return!0})});this.a=function(a){h=void 0!==a?a:f}};function Ha(a){this.multiply=function(b){var c=b.elements();b=a[0];var f=a[1],e=a[2],h=a[3],k=a[4],d=a[5],m=a[6],l=a[7],p=a[8],g=c[0],q=c[1],n=c[2],r=c[3],u=c[4],t=c[5],y=c[6],v=c[7];c=c[8];a[0]=g*b+q*h+n*m;a[1]=g*f+q*k+n*l;a[2]=g*e+q*d+n*p;a[3]=r*b+u*h+t*m;a[4]=r*f+u*k+t*l;a[5]=r*e+u*d+t*p;a[6]=y*b+v*h+c*m;a[7]=y*f+v*k+c*l;a[8]=y*e+v*d+c*p;return this};this.transform=function(b,c){return[b*a[0]+c*a[3]+1*a[6],b*a[1]+c*a[4]+1*a[7],b*a[2]+c*a[5]+1*a[8]]};this.translate=function(a,c){return this.multiply(new Ha([1,
0,0,0,1,0,a,c,1]))};this.scale=function(a,c){return this.multiply(new Ha([a,0,0,0,c,0,0,0,1]))};this.elements=function(){return a}}function Q(){return new Ha([1,0,0,0,1,0,0,0,1])};function Ia(a){function b(a){function b(a,b,g,c){b.use(function(){k.use(function(){k.g("aVertexPosition",B);k.v("uSampler",a,0);k.D("increment",g,c);k.G(["aVertexPosition"]);k.Y(B.m())})})}var g=l.width()+l.margin(),c=l.height()+l.margin();e.viewport(0,0,g,c);e.enable(e.BLEND);e.blendEquation(e.FUNC_ADD);e.blendFunc(e.ONE,e.ONE);e.clearColor(0,0,0,0);var d=Math.min(G,C.m());d?(u.use(function(){e.clear(e.COLOR_BUFFER_BIT);h.use(function(){h.g("aVertexPosition",w,e.BYTE,!0);h.g("aPointData",C,e.FLOAT,
!1,0,0,!0);h.v("uProfile",r,0);h.ga(a.elements());h.G(["aVertexPosition","aPointData"]);h.qa(d,w.m())})}),e.disable(e.BLEND),b(t,y,1,0),b(v,u,0,1)):u.use(function(){e.clear(e.COLOR_BUFFER_BIT)})}function c(a){h.use(function(){h.f("uRadiusPow",a)});m=void 0;n=!0}function f(a,b){var g=new Float32Array(3*a.length),c=0;a.sort(function(a,b){return b.elevation-a.elevation});if(0<a.length){var d=a[0].elevation;for(var e=J(a),f=e.next();!f.done;f=e.next())f=f.value,d<f.elevation&&(d=f.elevation)}else d=1;
e=J(a);for(f=e.next();!f.done;f=e.next())f=f.value,g[c++]=f.x,g[c++]=f.y,g[c++]=f.elevation/d;b.setData(g,3,a.length)}var e=a.Z,h=a.createProgram({name:"heightmap",T:"\n      precision mediump float;\n      uniform float uMaxRadius;\n      uniform float uRadiusPow;\n      uniform float uCircumToInscribedRadius;\n\n      attribute vec2 aVertexPosition;\n      attribute vec3 aPointData;\n\n      varying vec2 coordinate;\n      varying vec3 pointData;\n\n      uniform mat3 uMvMatrix;\n\n      void main(void) {\n        float radius = pow(aPointData.z, uRadiusPow) * uMaxRadius;\n        // If we switch to representing elevations by some other shape,\n        // we'd need to pass a different scaling factor.\n        // We need the factor because the coordinates are passed in as\n        // unsigned bytes and normalized to the 0..1 range by the GPU.\n        // Here we need a triangle with inscribed circle of radius 1.0,\n        // that's why we need to apply the extra scaling.\n        vec2 scaled = uCircumToInscribedRadius * aVertexPosition * radius + aPointData.xy;      \n      \n        gl_Position = vec4(uMvMatrix * vec3(scaled, 1.0), 1.0);\n        coordinate = scaled;\n        pointData = aPointData;\n      }\n    ",
N:"\n      precision mediump float;\n      uniform float uMaxRadius;\n      uniform float uRadiusPow;\n      uniform sampler2D uProfile;\n\n      varying vec2 coordinate;\n      varying vec3 pointData;\n\n      void main(void) {\n        float radius = pow(pointData.z, uRadiusPow) * uMaxRadius;\n        float d = length(coordinate - pointData.xy) / radius;\n        float h = radius * texture2D(uProfile, vec2(d, 0.0)).r;\n\n        gl_FragColor = vec4(h, 0.0, 0.0, 0.0);\n      }\n    ",K:["aVertexPosition",
"aPointData"],M:["uMaxRadius","uRadiusPow","uCircumToInscribedRadius","uMvMatrix","uProfile"]}),k=a.createProgram({name:"prefiltering",T:"\n      precision mediump float;\n      attribute vec2 aVertexPosition;\n  \n      void main(void) {\n        gl_Position = vec4(aVertexPosition, 1.0, 1.0);\n      }\n    ",N:"\n      precision mediump float;\n      uniform sampler2D uSampler;                                                 \n      uniform vec2 increment;                                                     \n      uniform vec2 uTextureResolution;\n\n      void main(void) {                                         \n        vec2 vTextureCoord = gl_FragCoord.xy / uTextureResolution;\n        vec4 w = 1.732176555 * texture2D(uSampler, vTextureCoord);              \n        vec2 inc = increment / uTextureResolution;\n        vec2 im = vTextureCoord - inc;                                    \n        vec2 ip = vTextureCoord + inc;                                    \n        w -= 0.464135309 * (texture2D(uSampler,im)+texture2D(uSampler,ip));     \n        im -= inc; ip += inc;                                       \n        w += 0.124364681 * (texture2D(uSampler,im)+texture2D(uSampler,ip));     \n        im -= inc; ip += inc;                                       \n        w -= 0.033323416 * (texture2D(uSampler,im)+texture2D(uSampler,ip));     \n        im -= inc; ip += inc;                                       \n        w += 0.008928982 * (texture2D(uSampler,im)+texture2D(uSampler,ip));     \n        im -= inc; ip += inc;                                       \n        w -= 0.002392514 * (texture2D(uSampler,im)+texture2D(uSampler,ip));     \n        im -= inc; ip += inc;                                       \n        w += 0.000641072 * (texture2D(uSampler,im)+texture2D(uSampler,ip));     \n        im -= inc; ip += inc;                                       \n        w -= 0.000171775 * (texture2D(uSampler,im)+texture2D(uSampler,ip));     \n        gl_FragColor = w;                                                       \n      }\n    ",
K:["aVertexPosition"],M:["uSampler","uTextureResolution","increment"]}),d=a.createProgram({name:"prefiltering",T:"\n      precision mediump float;\n      attribute vec2 aVertexPosition;\n  \n      void main(void) {\n        gl_Position = vec4(aVertexPosition, 1.0, 1.0);\n      }\n    ",N:"\n      precision mediump float;\n      uniform sampler2D uHeightmap;                                                 \n      uniform vec2 uTextureResolution;\n\n      void main(void) {                                         \n        vec2 vTextureCoord = gl_FragCoord.xy / uTextureResolution;\n        \n        // < 0 values are filtering artifacts, they mess with\n        // modulos, so stick to >= 0 heights.\n        float h = max(0.0, texture2D(uHeightmap, vTextureCoord).r);     \n        \n        // Pack the float into 4 bytes. GLSL uses 0..1 normalized\n        // floats for 0..255 bytes, hence the division by 256.0.\n        gl_FragColor = vec4(\n          mod(floor(h / 65536.0), 256.0) / 256.0, \n          mod(h / 256.0, 256.0) / 256.0, \n          mod(h, 256.0) / 256.0, \n          fract(h)\n        );                                                       \n      }\n    ",
K:["aVertexPosition"],M:["uHeightmap","uTextureResolution"]}),m,l,p,g,q,n,r=function(b){for(var g=Ca(.2,0,.15),c=new Float32Array(4*b),d=0;d<c.length;)c[d]=1-g((d>>2)/(b-1)),d+=4;return a.createTexture(c,c.length>>2,1,e.LINEAR)}(e.getParameter(e.MAX_TEXTURE_SIZE)),u=a.createFramebuffer(),t,y=a.createFramebuffer(),v,z=a.createFramebuffer(),x,w=a.createBuffer(),A=function(a){for(var b=2*Math.PI/3,c=1/Math.cos(b/2),g=127/c,d=1/Math.cos(b/2),e=new Int8Array(6),f=0,h=0;3>h;h++){var l=h*b;e[f++]=g*c*Math.sin(l);
e[f++]=g*c*Math.cos(l)}a.setData(e,2,3);return d}(w);h.use(function(){h.f("uCircumToInscribedRadius",A)});var B=a.da(),C=a.createBuffer();c(.5);this.i=function(b){function c(b,c){c=void 0===c?e.FLOAT:c;var g=a.createTexture(null,l.oa(),l.na(),e.LINEAR,e.RGBA,c);b.use(function(){e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,g.W(),0)});return g}l=b;t&&t.release();t=c(u);v&&v.release();v=c(y);x&&x.release();x=c(z,e.UNSIGNED_BYTE);k.use(function(){k.D("uTextureResolution",l.oa(),
l.na())});d.use(function(){d.D("uTextureResolution",l.oa(),l.na())});n=!0};this.V=function(a){q=a;n=!0};this.S=function(a){g=a};this.b=function(a){f(a,C);0<a.length?p=va(a).ab()||Math.sqrt(2):p=1;this.a(D);n=!0};this.J=function(){n&&(n=!1,b(q))};this.release=function(){r.release();t.release();v.release();u.release();y.release();w.release();C.release();B.release()};this.P=function(){if(void 0!==m)return m;b(g);z.use(function(){e.clear(e.COLOR_BUFFER_BIT);d.use(function(){d.g("aVertexPosition",B);d.v("uHeightmap",
t,0);d.G(["aVertexPosition"]);d.Y(B.m())})});z.use(function(){var a=l.width(),b=l.height(),c=new Uint8Array(a*b*4);e.readPixels(0,0,a,b,e.RGBA,e.UNSIGNED_BYTE,c);for(b=a=0;b<c.length;){var g=c[b++],d=c[b++],f=c[b++];g=c[b++]/256+f+256*d+65536*g;a<g&&(a=g)}a||(a=1);m=a});n=!0;return m};this.L=function(){return t};var D=20;this.h=function(){return D};this.a=function(a){D=a;h.use(function(){h.f("uMaxRadius",p/D)});m=void 0;n=!0};this.a(D);var G=Number.MAX_SAFE_INTEGER;this.c=function(){return G};this.o=
function(a){G=a;m=void 0;n=!0};this.R=c};function Ja(a){function b(){var a=Math.cos(n)*Math.cos(r),b=Math.sin(n)*Math.cos(r),c=Math.sin(r);f.use(function(){f.ac(a,b,c)})}var c=a.Z,f=a.createProgram({name:"shading",T:"\n      precision mediump float;\n      attribute vec2 aVertexPosition;\n  \n      void main(void) {\n        gl_Position = vec4(aVertexPosition, 1.0, 1.0);\n      }\n    ",N:"\n      #extension GL_OES_standard_derivatives : enable\n      precision mediump float;\n      uniform sampler2D uFbTexture;\n      uniform sampler2D uBandsTexture;\n      uniform sampler2D uBandLevelsTexture;\n      uniform sampler2D uMaskTexture;\n      uniform vec2 uViewportSize;\n      uniform vec2 uViewport;\n      uniform vec2 uTextureSize;\n      uniform float uMax;\n      uniform float uElevationOffset;\n      uniform vec3 uLight;\n      uniform float uLightIntensity;\n      uniform float uPixelNorm;\n      uniform float uContourOpacity;\n      uniform float uContourWidth;\n      uniform float uOpacity;\n      uniform float uSaturation;\n      uniform float uLightness;\n\n  \n      vec4 cubic(float v) {\n        vec4 n = vec4(1.0, 2.0, 3.0, 4.0) - v;\n        vec4 s = n * n * n;\n        float x = s.x;\n        float y = s.y - 4.0 * s.x;\n        float z = s.z - 4.0 * s.y + 6.0 * s.x;\n        float w = 6.0 - x - y - z;\n        return vec4(x, y, z, w) * (1.0/6.0);\n      }\n      \n      vec4 textureBicubic(sampler2D sampler, vec2 texSize, vec2 texCoords) {\n        vec2 invTexSize = 1.0 / texSize;\n         \n        texCoords = texCoords * texSize - 0.5;\n         \n        vec2 fxy = fract(texCoords);\n        texCoords -= fxy;\n    \n        vec4 xcubic = cubic(fxy.x);\n        vec4 ycubic = cubic(fxy.y);\n    \n        vec4 c = texCoords.xxyy + vec2(-0.5, +1.5).xyxy;\n        \n        vec4 s = vec4(xcubic.xz + xcubic.yw, ycubic.xz + ycubic.yw);\n        vec4 offset = c + vec4(xcubic.yw, ycubic.yw) / s;\n        \n        offset *= invTexSize.xxyy;\n        \n        vec4 sample0 = texture2D(sampler, offset.xz);\n        vec4 sample1 = texture2D(sampler, offset.yz);\n        vec4 sample2 = texture2D(sampler, offset.xw);\n        vec4 sample3 = texture2D(sampler, offset.yw);\n    \n        float sx = s.x / (s.x + s.y);\n        float sy = s.z / (s.z + s.w);\n    \n        return mix(mix(sample3, sample2, sx), mix(sample1, sample0, sx) , sy);\n      }\n      \n      float Epsilon = 1e-10;\n \n      vec3 RGBtoHCV(vec3 RGB)\n      {\n        // Based on work by Sam Hocevar and Emil Persson\n        vec4 P = (RGB.g < RGB.b) ? vec4(RGB.bg, -1.0, 2.0/3.0) : vec4(RGB.gb, 0.0, -1.0/3.0);\n        vec4 Q = (RGB.r < P.x) ? vec4(P.xyw, RGB.r) : vec4(RGB.r, P.yzx);\n        float C = Q.x - min(Q.w, Q.y);\n        float H = abs((Q.w - Q.y) / (6.0 * C + Epsilon) + Q.z);\n        return vec3(H, C, Q.x);\n      }\n      \n      vec3 RGBtoHSL(vec3 RGB)\n      {\n        vec3 HCV = RGBtoHCV(RGB);\n        float L = HCV.z - HCV.y * 0.5;\n        float S = HCV.y / (1.0 - abs(L * 2.0 - 1.0) + Epsilon);\n        return vec3(HCV.x, S, L);\n      }\n      \n      vec3 HUEtoRGB(float H)\n      {\n        float R = abs(H * 6.0 - 3.0) - 1.0;\n        float G = 2.0 - abs(H * 6.0 - 2.0);\n        float B = 2.0 - abs(H * 6.0 - 4.0);\n        return clamp(vec3(R, G, B), 0.0, 1.0);\n      }\n      \n      vec3 HSLtoRGB(vec3 HSL)\n      {\n        vec3 RGB = HUEtoRGB(HSL.x);\n        float C = (1.0 - abs(2.0 * HSL.z - 1.0)) * HSL.y;\n        return (RGB - 0.5) * C + HSL.z;\n      }\n      \n      void main(void) {\n        // Unpack 3 half-floats into a float to recover some more precision.\n        // vec3 ph = texture2D(uFbTexture, vTexturePosition).xyz;\n        // float h = (ph.x + (ph.y + ph.z) / 64.0) / (32.0 * uMax);\n\n        // Map height at the currently processed pixel.\n        // float h = texture2D(uFbTexture, gl_FragCoord.xy / uViewportSize).x / uMax;\n        float h = textureBicubic(uFbTexture, uTextureSize, gl_FragCoord.xy / uViewportSize).x / uMax + uElevationOffset;\n  \n        // Height deltas along x and y.\n        float dhx = dFdx(h);\n        float dhy = dFdy(h);\n  \n        // Band colors and the corresponding height levels.\n        vec4 bandColor = texture2D(uBandsTexture, vec2(h, 0.0));\n        vec4 bandLevels = texture2D(uBandLevelsTexture, vec2(h, 0.0));\n  \n        // Distance to the nearest band's boundary height.\n        // We can get a negative value here due to sampling, hence abs().\n        float dh = abs(min(h - bandLevels.r, bandLevels.g - h));\n  \n        // Detect band boundary edges and mark them.\n        float skipContouringFlag = bandLevels.b;\n        float dsx = dh / sqrt(dhx * dhx + dhy * dhy);\n        \n        // Label mask, applies to contours only\n        float mask = min(1.0, texture2D(uMaskTexture, gl_FragCoord.xy / uViewport).a * 8.0);\n\n        float multiplier = mix(max(max(skipContouringFlag, 1.0 - uContourOpacity), mask), 1.0, smoothstep(0.0, uContourWidth, dsx));\n  \n        // Lighting.\n        vec3 normal = vec3(dhx, dhy, uPixelNorm); // surface normal (cross product folded in and simplified to avoid useless computation)\n        float lightCos = (uLightIntensity * dot(normal, uLight) / length(normal) + 1.0) / 2.0;\n  \n        // Compose the final pixel color.\n        // bandColor.a contains a flag: 1.0 to light-shade the band color, 0.0 not to shade\n        float shadingFlag = bandColor.a;\n        float light = mix(0.5, lightCos, shadingFlag);\n        \n        // Lighten or darken depending on light\n        // TODO: use HSL to apply lighting?\n        vec3 color = bandColor.rgb * step(0.5, 1.0 - light) * (light * 2.0) +\n                     (bandColor.rgb + (1.0 - bandColor.rgb) * (light - 0.5) * 2.0) * (1.0 - step(0.5, 1.0 - light));\n                     \n        vec3 colorHsl = RGBtoHSL(color);\n        \n        gl_FragColor = vec4(HSLtoRGB(clamp(colorHsl + vec3(0.0, uSaturation, uLightness), 0.0, 1.0)) * multiplier, uOpacity);                                                       \n      }\n    ",
K:["aVertexPosition"],M:"fbTextureBuffer uBandsTexture uBandLevelsTexture uViewportSize uTextureSize uMax uLight uPixelNorm uContourWidth uContourOpacity uLightIntensity uOpacity uSaturation uLightness uMaskTexture uViewport uElevationOffset".split(" ")}),e=[{end:3E-4,color:[141,193,234],C:!1,w:!1},{end:.005,color:[161,210,247],C:!1,w:!1},{end:.02,color:[185,227,255],C:!1,w:!0},{end:.05,color:[172,208,165],C:!0,w:!0},{end:.1,color:[148,191,139],C:!0,w:!0},{end:.15,color:[168,198,143],C:!0,w:!0},{end:.2,
color:[189,204,150],C:!0,w:!0},{end:.3,color:[209,215,171],C:!0,w:!0},{end:.4,color:[239,235,192],C:!0,w:!0},{end:.5,color:[222,214,163],C:!0,w:!0},{end:.6,color:[211,202,157],C:!0,w:!0},{end:.7,color:[202,185,130],C:!0,w:!0},{end:.8,color:[192,154,83],C:!0,w:!0},{end:.85,color:[224,224,224],C:!0,w:!0},{end:.9,color:[236,236,236],C:!0,w:!0},{end:1,color:[255,255,255],C:!0,w:!0}],h,k=1,d,m,l=function(b){for(var g=new Float32Array(4*b),d=0,f=0;d<g.length;){for(var h=(d>>2)/(b-1);e[f].end<h;)f++;h=e[f];
g[d++]=h.color[0]/256;g[d++]=h.color[1]/256;g[d++]=h.color[2]/256;g[d++]=h.C?1:0}return a.createTexture(g,g.length>>2,1,c.NEAREST)}(c.getParameter(c.MAX_TEXTURE_SIZE)),p=function(b){for(var g=new Float32Array(4*b),d=0,f=0;d<g.length;){for(var h=(d>>2)/(b-1);e[f].end<h;)f++;g[d++]=f?e[f-1].end:0;g[d++]=e[f].end;d++;d++}for(b=0;!e[b].w;)b++;if(b<e.length)for(b=(Math.floor((e[b-1].end+(b+1<e.length?e[b].end:1))/2*(g.length>>2))<<2)+2;0<=b;b-=4)g[b]=1;return a.createTexture(g,g.length>>2,1,c.NEAREST)}(c.getParameter(c.MAX_TEXTURE_SIZE)),
g=a.da();this.V=function(a){h=a};this.ja=function(a,b){d=a;m=b};this.ka=function(a,b,c,e){f.use(function(){f.g("aVertexPosition",g);f.v("fbTextureBuffer",a,0);f.v("uBandsTexture",l,1);f.v("uBandLevelsTexture",p,2);f.v("uMaskTexture",e,3);f.f("uMax",b);f.D("uViewportSize",h.oa()*h.eb()*h.fb(),h.na()*h.eb()*h.fb());f.D("uTextureSize",h.oa(),h.na());f.f("uPixelNorm",2/(c*d));f.D("uViewport",d,m);f.G(["aVertexPosition"]);f.Y(g.m())})};this.release=function(){l.release();p.release()};this.ia=function(a){k=
a;this.a(q)};this.o=function(a){f.use(function(){f.f("uElevationOffset",a)})};this.o(0);this.ha=function(a){f.use(function(){f.f("uOpacity",a)})};this.J=function(a){f.use(function(){f.f("uLightness",a)})};this.J(0);this.L=function(a){f.use(function(){f.f("uSaturation",a)})};this.L(0);this.b=function(a){f.use(function(){f.f("uContourOpacity",a)})};this.b(.2);var q=.9;this.P=function(){return q};this.a=function(a){q=a;f.use(function(){f.f("uContourWidth",a*k)})};this.a(q);var n=2*Math.PI-Math.PI/2-
Math.PI/4,r=Math.PI-Math.PI/8;this.S=function(){return n};this.h=function(a){n=a;b()};this.h(n);this.R=function(){return r};this.c=function(a){r=a;b()};this.c(r);this.i=function(a){f.use(function(){f.f("uLightIntensity",a)})};this.i(.15)};function Ka(a){var b=a.Z,c=a.createProgram({name:"dots",T:"\n      attribute vec3 aMarkerPosition;\n      attribute vec4 aMarkerColor;\n      attribute float aMarkerOpacity;\n      attribute float aMarkerType;\n  \n      varying vec4 vMarkerColor;\n      varying float vMarkerOpacity;\n      varying float vMarkerType;\n      varying float vMarkerSize;\n  \n      uniform mat3 uMvMatrix;\n      uniform float uPointScale;\n      uniform float uMinAbsolutePointSize;\n  \n      void main(void) {\n        gl_Position = vec4(\n          (uMvMatrix * vec3(aMarkerPosition.xy, 1.0)) + \n          vec3(0.0, 0.0, 2.0 * step(aMarkerOpacity, 0.0)), // z-filtering for opacity==0 markers\n          1.0);\n          \n        // The +2.0 factor is an extra 2-pixel margin for antialiasing.\n        gl_PointSize = max(uPointScale * aMarkerPosition.z, uMinAbsolutePointSize);\n        vMarkerColor = aMarkerColor;\n        vMarkerOpacity = aMarkerOpacity;\n        vMarkerType = floor(aMarkerType);\n        vMarkerSize = gl_PointSize;\n      }\n    ",
N:"\n      #extension GL_OES_standard_derivatives : enable\n      precision mediump float;\n      uniform float uMarkerOpacity;\n      uniform float uFillOpacity;\n      uniform float uStrokeOpacity;\n      uniform float uStrokeWidth;\n      uniform sampler2D uMaskTexture;\n      uniform vec2 uViewport;\n\n      varying vec4 vMarkerColor;\n      varying float vMarkerOpacity;\n      varying float vMarkerType;\n      varying float vMarkerSize;\n\n      void main(void) {\n        const float      PI = 3.14159265359;\n        const float  TWO_PI = 6.28318530718;\n\n        // Position of the fragment, in the -1.0...1.0 range.\n        vec2 pos = 2.0 * gl_PointCoord - 1.0;\n      \n        // We draw the shapes and strokes using the signed distance field technique.\n        // Variable d represents the distance to the _boundary_ of the shape.\n        // Pixels where d is close to 0 lie on the stroke of the shape.\n        // Pixels where 0.0 < d < 1.0 are inside the shape. \n        // The only tricky bit is to compute d for the specific shape. \n        float d = 0.0;\n        \n        // Accept thread divergence for now. If we see performance problems, \n        // we can can always convert the code to remove conditions.\n        if (vMarkerType == 2.0) {\n          // Square\n          vec2 t = 1.0 - abs(pos);\n          d = min(t.x, t.y);\n        } else if (vMarkerType == 1.0) {\n          // Triangle\n          float angle = atan(pos.x, pos.y) + PI;\n          float r = TWO_PI / 3.0; // the constant is the number of vertices\n          d = 1.02 - sqrt(cos(floor(0.5 + angle / r) * r - angle) * r * length(pos));\n        } else {\n          // Circle\n          d = 1.0 - sqrt(dot(pos, pos));\n        }\n      \n        // Now fill and stroke the shape. Apply some anti-aliasing too.\n        // Add some margin for anti-aliasing.\n        float margin = 2.0 / vMarkerSize;\n        float delta = fwidth(d) * 0.75;\n        \n        float alpha = max(\n                        uStrokeOpacity * \n                          (1.0 - smoothstep(uStrokeWidth - delta, uStrokeWidth + delta, d)) * \n                          smoothstep(margin - delta, margin + delta, d),\n                        uFillOpacity * step(uStrokeWidth - delta * 0.5, d)\n                      );\n        \n        // Apply mask and fill the pixels.\n        float mask = min(1.0, texture2D(uMaskTexture, gl_FragCoord.xy / uViewport).a * 8.0);\n        gl_FragColor = vec4(mix(vMarkerColor.rgb, vec3(1.0, 1.0, 1.0), 0.5 * mask), \n          vMarkerOpacity * vMarkerColor.a * alpha * uMarkerOpacity * (1.0 - 0.5 * mask));\n      }\n    ",
K:["aMarkerPosition","aMarkerColor","aMarkerType","aMarkerOpacity"],M:"uMvMatrix uPointScale uMarkerOpacity uFillOpacity uStrokeOpacity uStrokeWidth uMaskTexture uViewport uMinAbsolutePointSize".split(" ")}),f,e,h;this.o=function(a,b){e=a;h=b};this.i=function(a){f=a};this.U=function(a,p,g,q){a.Ya();var l=a.Qa();0!==l.m()&&c.use(function(){c.g("aMarkerPosition",l);c.g("aMarkerColor",a.Cb(),b.UNSIGNED_BYTE,!0);c.g("aMarkerOpacity",a.Fb(),b.UNSIGNED_BYTE,!0);c.g("aMarkerType",a.Eb(),b.UNSIGNED_BYTE,
!1);c.ga(p);c.f("uPointScale",d*a.ba()*f*Math.min(Math.sqrt(g),4));c.f("uMinAbsolutePointSize",m*f);c.f("uMarkerOpacity",k*a.ea());c.f("uFillOpacity",a.Db());c.f("uStrokeOpacity",a.Gb());c.f("uStrokeWidth",Math.min(1,Math.max(0,a.Hb())));c.v("uMaskTexture",q,0);c.D("uViewport",e,h);c.G(["aMarkerPosition","aMarkerColor","aMarkerType","aMarkerOpacity"]);b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);c.bb(l.m())})};var k=
1;this.ea=function(){return k};this.b=function(a){k=a};var d=1;this.ba=function(){return d};this.c=function(a){d=a};var m=1;this.a=function(){return m};this.h=function(a){m=a}};function La(a,b){var c=a.Z,f=a.createFramebuffer(),e,h;this.a=function(k,d){h&&h.release();h=a.createTexture(null,k,d,c.LINEAR,c.RGBA,c.UNSIGNED_BYTE);f.use(function(){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,h.W(),0)});b&&(e&&e.release(),e=a.sb(k,d))};this.capture=function(a){b?f.use(function(){e.use(a)}):f.use(a);return h}};function Ma(a){var b=a.createProgram({name:"fullscreen",T:"\n      precision mediump float;\n      attribute vec2 aVertexPosition;\n  \n      void main(void) {\n        gl_Position = vec4(aVertexPosition, 1.0, 1.0);\n      }\n    ",N:"\n      precision mediump float;\n\n      uniform vec2 uResolution;\n      uniform sampler2D uInput;\n\n      void main() {\n        vec2 uv = vec2(gl_FragCoord.xy / uResolution.xy);\n        gl_FragColor = texture2D(uInput, uv);\n      }\n    ",K:["aVertexPosition"],
M:["uInput","uResolution"]}),c=a.da(),f,e;this.a=function(a,b){f=a;e=b};this.U=function(a){b.use(function(){b.g("aVertexPosition",c);b.v("uInput",a,0);b.D("uResolution",f,e);b.G(["aVertexPosition"]);b.Y(c.m())})}};function Na(a,b){var c=new La(a,void 0===b?!1:b),f=new Ma(a),e;this.a=function(a,b){c.a(a,b);f.a(a,b)};this.capture=function(a){return e=c.capture(a)};this.U=function(a){f.U(a||e)};this.W=function(){return e}};function Oa(a){var b=a.Z,c=a.createProgram({name:"blur",T:"\n      precision mediump float;\n      attribute vec2 aVertexPosition;\n  \n      void main(void) {\n        gl_Position = vec4(aVertexPosition, 1.0, 1.0);\n      }\n    ",N:"\n      precision mediump float;\n\n      uniform vec2 uResolution;\n      uniform sampler2D uInput;\n      uniform vec2 direction;\n\n      // https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/5.glsl\n      vec4 blur5(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n        vec4 color = vec4(0.0);\n        vec2 off1 = vec2(1.3333333333333333) * direction;\n        color += texture2D(image, uv) * 0.29411764705882354;\n        color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\n        color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\n        return color; \n      }\n      \n      void main() {\n        vec2 uv = vec2(gl_FragCoord.xy / uResolution.xy);\n        gl_FragColor = blur5(uInput, uv, uResolution.xy, direction);\n      }\n    ",
K:["aVertexPosition"],M:["uInput","uResolution","direction"]}),f=a.da(),e=a.createFramebuffer(),h,k=a.createFramebuffer(),d,m;this.b=function(c,f){d=c;m=f;h&&h.release();h=a.createTexture(null,c,f,b.LINEAR,b.RGBA,b.UNSIGNED_BYTE);e.use(function(){b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,h.W(),0)})};this.a=function(a,p,g,q){g=void 0===g?2:g;q=void 0===q?1:q;k.use(function(){b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,p.W(),0)});b.disable(b.BLEND);
for(var l={fa:0};l.fa<g;l={fa:l.fa},l.fa++)e.use(function(e){return function(){b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT);c.use(function(){c.g("aVertexPosition",f);c.v("uInput",e.fa?p:a,0);c.D("uResolution",d,m);c.D("direction",q*(g-e.fa),0);c.G(["aVertexPosition"]);c.Y(f.m())})}}(l)),k.use(function(a){return function(){b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT);c.use(function(){c.g("aVertexPosition",f);c.v("uInput",h,0);c.D("uResolution",d,m);c.D("direction",0,q*(g-a.fa));c.G(["aVertexPosition"]);
c.Y(f.m())})}}(l))}};function Pa(a){var b=a.Z,c=a.createProgram({name:"dots",T:"\n      attribute vec3 aMarkerPosition;\n  \n      uniform mat3 uMvMatrix;\n      uniform float uPointScale;\n      uniform float uOutlineRadiusOffset;\n      uniform float uOutlineRadiusMultiplier;\n  \n      void main(void) {\n        gl_Position = vec4(\n          (uMvMatrix * vec3(aMarkerPosition.xy, 1.0)),\n          1.0);\n          \n        gl_PointSize = uPointScale * (aMarkerPosition.z * uOutlineRadiusMultiplier + uOutlineRadiusOffset);\n      }\n    ",
N:"\n      precision mediump float;\n      uniform vec2 uViewport;\n\n      void main(void) {\n        // Position of the fragment, in the -1.0...1.0 range.\n        vec2 pos = 2.0 * gl_PointCoord - 1.0;\n        \n        float v = 1.0 - step(1.0, sqrt(dot(pos, pos)));\n\n        gl_FragColor = vec4(v, v, v, v);\n      }\n    ",K:["aMarkerPosition"],M:["uMvMatrix","uPointScale","uOutlineRadiusMultiplier","uOutlineRadiusOffset"]}),f=a.createProgram({name:"outlineBorder",T:"\n      precision mediump float;\n      attribute vec2 aVertexPosition;\n  \n      void main(void) {\n        gl_Position = vec4(aVertexPosition, 1.0, 1.0);\n      }\n    ",
N:"\n      #extension GL_OES_standard_derivatives : enable\n      precision mediump float;\n\n      uniform vec2 uResolution;\n      uniform vec4 uFillColor;\n      uniform vec4 uStrokeColor;\n      uniform float uOutlineStrokeWidth;\n      uniform sampler2D uHeightmap;\n      uniform sampler2D uMaskTexture;\n\n      void main() {\n        vec2 uv = vec2(gl_FragCoord.xy / uResolution.xy);\n        float h = texture2D(uHeightmap, uv).a;\n        \n        // Height deltas along x and y.\n        float dhx = dFdx(h);\n        float dhy = dFdy(h);\n        \n        // Label mask, applies to contours only\n        float mask = min(1.0, texture2D(uMaskTexture, gl_FragCoord.xy / uResolution).a * 8.0);\n        \n        // Distance to the nearest band's boundary height.\n        float dsx = (h - uOutlineStrokeWidth) / sqrt(dhx * dhx + dhy * dhy);\n\n        float cs = max(smoothstep(-1.0, 1.0, dsx), mask);\n        float ss = smoothstep(0.0, 1.0 - uOutlineStrokeWidth, h);\n        gl_FragColor = vec4(mix(uStrokeColor, uFillColor, cs).rgb, ss * mix(uStrokeColor.a, uFillColor.a, cs));\n      }\n    ",
K:["aVertexPosition"],M:"uHeightmap uMaskTexture uResolution uFillColor uStrokeColor uOutlineStrokeWidth".split(" ")}),e,h=new Na(a),k=new Oa(a),d=a.da(),m,l=a.createFramebuffer();this.c=function(c,d){h.a(c,d);k.b(c,d);f.use(function(){f.D("uResolution",c,d)});m&&m.release();m=a.createTexture(null,c,d,b.LINEAR,b.RGBA,b.UNSIGNED_BYTE);l.use(function(){b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,m.W(),0)})};this.b=function(a){e=a};this.U=function(a,l,n,r){a.Ya();var g=a.Qa();
0!==g.m()&&(h.capture(function(){b.clearColor(0,0,0,0);b.clear(b.COLOR_BUFFER_BIT);c.use(function(){c.g("aMarkerPosition",g);c.ga(l);c.f("uPointScale",e*Math.min(Math.sqrt(n),4));c.f("uOutlineRadiusMultiplier",p);c.f("uOutlineRadiusOffset",a.Jb());c.G(["aMarkerPosition"]);b.enable(b.BLEND);b.blendEquation(b.FUNC_ADD);b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);c.bb(g.m())})}),k.a(h.W(),m,2,Math.min(1,e/2)),b.enable(b.BLEND),f.use(function(){f.g("aVertexPosition",
d);f.v("uHeightmap",m,0);f.v("uMaskTexture",r,1);f.jb("uFillColor",a.Ib());f.jb("uStrokeColor",a.Kb());f.f("uOutlineStrokeWidth",a.Lb());f.G(["aVertexPosition"]);f.Y(d.m())}))};var p=1;this.a=function(a){p=a}};function Qa(a,b){function c(){for(var a=new Float32Array(3*k.length),b=0,c=J(k),g=c.next();!g.done;g=c.next())g=g.value,a[b++]=g.x,a[b++]=g.y,g=g.markerSize||0,a[b++]=Math.max(0,Math.min(1,g));q.setData(a,3,k.length)}function f(){for(var a=new Uint8ClampedArray(k.length),b=0;b<k.length;b++){var c=0;switch(k[b].marker){case "square":c|=2;break;case "triangle":c|=1}a[b]=c}u.setData(a,1,k.length)}function e(){for(var a=new Uint8ClampedArray(4*k.length),b=0,c=[255,255,255,128],g=0;g<k.length;g++){var d=
k[g].markerColor||c;a[b++]=d[0];a[b++]=d[1];a[b++]=d[2];a[b++]=d[3]}n.setData(a,4,k.length)}function h(){for(var a=new Uint8ClampedArray(k.length),b=0;b<k.length;b++){var c=k[b].markerOpacity;a[b]=255*(void 0===c?1:c)}r.setData(a,1,k.length)}var k,d=!0,m=!0,l=!0,p=!0,g=!0,q=b.createBuffer(),n=b.createBuffer(),r=b.createBuffer(),u=b.createBuffer();this.Ua=function(){d=!0};this.Ra=function(){m=!0};this.sa=function(){l=!0};this.Sa=function(){p=!0};this.Ta=function(){g=!0};this.Ya=function(){if(d||l)d&&
(k=a.points.filter(function(a){return void 0!==a.marker}),g=p=m=!0),c(),l=d=!1;m&&(e(),m=!1);p&&(h(),p=!1);g&&(f(),g=!1)};this.Qa=function(){return q};this.Cb=function(){return n};this.Fb=function(){return r};this.Eb=function(){return u};this.ea=function(){return P(a.markerOpacity,1)};this.Db=function(){return P(a.markerFillOpacity,.35)};this.Gb=function(){return P(a.markerStrokeOpacity,1)};this.Hb=function(){return P(a.markerStrokeWidth,.25)};this.ba=function(){return P(a.markerSizeMultiplier,1)};
this.gb=function(){return!1!==a.visible}};function Ra(a,b){function c(){for(var a=new Float32Array(3*f.length),b=0,c=J(f),d=c.next();!d.done;d=c.next())d=d.value,a[b++]=d.x,a[b++]=d.y,d=d.markerSize||0,a[b++]=Math.max(0,Math.min(1,d));m.setData(a,3,f.length)}var f,e=[255,255,255,128],h=[0,0,0,255],k=!0,d=!0,m=b.createBuffer();this.Wa=function(){k=!0};this.sa=function(){d=!0};this.Ya=function(){if(k||d)k&&(f=a.points.filter(function(a){return void 0!==a.marker})),c(),d=k=!1};this.Qa=function(){return m};this.Jb=function(){return P(a.outlineRadiusOffset,
8)};this.Ib=function(){return P(a.outlineFillColor,e)};this.Kb=function(){return P(a.outlineStrokeColor,h)};this.Lb=function(){return P(a.outlineStrokeWidth,.5)};this.gb=function(){return!1!==a.visible}};function Sa(a){var b=a.createProgram({name:"fullscreen",T:"\n      precision mediump float;\n      attribute vec2 aVertexPosition;\n  \n      void main(void) {\n        gl_Position = vec4(aVertexPosition, 1.0, 1.0);\n      }\n    ",N:"\n      precision mediump float;\n\n      uniform float uStrength;\n      uniform vec2 uResolution;\n      uniform sampler2D uInput;\n      uniform sampler2D uBlurred;\n\n      void main() {\n        vec2 uv = vec2(gl_FragCoord.xy / uResolution.xy);\n        vec4 b = texture2D(uBlurred, uv);\n        vec4 i = texture2D(uInput, uv);\n        \n        gl_FragColor = mix(vec4(1.0 - b.rgb, b.a), vec4(1.0 - i.rgb, i.a), \n          1.0 + uStrength * i.a / (0.01 + i.r + i.g + i.b));\n      }\n    ",
K:["aVertexPosition"],M:["uInput","uBlurred","uStrength","uResolution","direction"]}),c=a.da(),f,e;this.a=function(a,b){f=a;e=b};this.U=function(a,k,d){b.use(function(){b.g("aVertexPosition",c);b.v("uInput",a,0);b.v("uBlurred",k,1);b.D("uResolution",f,e);b.f("uStrength",d);b.G(["aVertexPosition"]);b.Y(c.m())})}};function Ta(a){var b=document.createElement("canvas");b.width=0;b.height=0;var c=b.getContext("2d");c.font=a+"px sans-serif";this.a=function(a){return Math.ceil(c.measureText(a).width)}};function Ua(){var a=[.5,0,1,.5,2,1,6,1,8,0];this.a=function(b){for(var c=0;c<a.length&&a[c]<b;)c+=2;if(!c)return a[1];if(c>=a.length)return a[a.length-1];var f=a[c-1],e=a[c-2];return f+(b-e)/(a[c]-e)*(a[c+1]-f)}};function Va(a,b){function c(a,b,c){var d=f(c[a]);for(a+=1;a<b;a++)d+=f(" "),d+=f(c[a]);return d}function f(a){var c=b["#"+a];if(!c)throw"Unknown width of '"+a+"'";return c}var e=new Ua;this.a=function(b,f){function d(g){for(var d=g.length,f=0,h=0,l=0,k=0;k<d;k++){var m=c(l,g[k],b);h+=m;l=g[k];m>f&&(f=m)}g=e.a(f/((d-1)*a*1.05+a));return 0===g?0:g*(1-(d*f-h)/(d*f))}if(1===b.length)f(b,[1]);else{if(6<b.length)throw"Algorithm not suitable for labels with more than 6 words";for(var h=1<<b.length-1,l=[b.length],
k=d(l),g=1;g<h;g++){for(var q=g,n=1,r=[],u=0;u<b.length-1;u++)q&1&&r.push(n),q>>=1,n++;r.push(n);q=d(r);k<q&&(k=q,l=r)}f(b,l)}};this.b=function(b,e,d){for(var h=e.length,l=(1.05-1)*a,k=-(1.05*a*h-l)/2,g=0,q=0;q<h;q++){for(var n=e[q],r=-(c(g,n,b)/2);g<n;g++){var u=f(b[g]);d(r,k,r+u,k+a,b[g]);r+=u;r+=f(" ")}g=n;k+=a+l}}};function Wa(a,b){if(256>a)return new Uint8Array(b);if(65536>a)return new Uint16Array(b);if(a<1<<32)return new Uint32Array(b);throw"Max value of "+a+" too large for typed arrays.";}function Xa(a,b){if(a.fill)a.fill.call(a,b);else for(var c=0;c<a.length;c++)a[c]=b}function Ya(a,b){if(a.reduce)return a.reduce.call(a,b,0);for(var c=0,f=0;f<a.length;f++)c=b(c,a[f],f,a);return c};function Za(a){var b=a.filter(function(a){return 0<=a[0]}).sort(function(a,b){return a[1]-b[1]}),c=Wa(b.length+1,a.length);for(a=0;a<b.length;a++)c[b[a][2]]=a+1;this.$a=function(a){a=c[a];if(0!==a)return b[a-1]};this.qb=function(){return b}}
function $a(a,b,c,f,e){b=b.map(function(a,b){return[-1,-1,b]});e=Math.floor(e/a);var h=new Int16Array(e);Xa(h,f);for(var k=0,d=0,m=0;k<b.length;){for(var l=b[k],p=c[k]+1,g=void 0,q=0;q<=m;q++)if(h[q]>=p){g=q;break}void 0===g&&m+1<e&&(m++,h[m]>=p&&(g=m));void 0!==g&&(l[0]=f-h[g],l[1]=g*a,h[g]-=p+1,d++);k++}a=Ya(h,function(a,b){return a+b});self.console.debug("Label canvas usage:",(100*(1-a/(e*f))).toFixed(2)+"%");return new Za(b)};function ab(a,b,c,f,e){c=c||0;f=f||a.length-1;for(e=e||bb;f>c;){if(600<f-c){var h=f-c+1,k=b-c+1,d=Math.log(h),m=.5*Math.exp(2*d/3);d=.5*Math.sqrt(d*m*(h-m)/h)*(0>k-h/2?-1:1);ab(a,b,Math.max(c,Math.floor(b-k*m/h+d)),Math.min(f,Math.floor(b+(h-k)*m/h+d)),e)}h=a[b];k=c;m=f;R(a,c,b);for(0<e(a[f],h)&&R(a,c,f);k<m;){R(a,k,m);k++;for(m--;0>e(a[k],h);)k++;for(;0<e(a[m],h);)m--}0===e(a[c],h)?R(a,c,m):(m++,R(a,m,f));m<=b&&(c=m+1);b<=m&&(f=m-1)}}function R(a,b,c){var f=a[b];a[b]=a[c];a[c]=f}
function bb(a,b){return a<b?-1:a>b?1:0};function cb(a,b){if(!(this instanceof cb))return new cb(a,b);this.b=Math.max(4,a||9);this.i=Math.max(2,Math.ceil(.4*this.b));b&&(a=["return a"," - b",";"],this.c=new Function("a","b",a.join(b[0])),this.h=new Function("a","b",a.join(b[1])),this.a=new Function("a","return {minX: a"+b[0]+", minY: a"+b[1]+", maxX: a"+b[2]+", maxY: a"+b[3]+"};"));this.clear()}
cb.prototype={search:function(a){var b=this.data,c=[],f=this.a.bind(this);if(!db(a,b))return c;for(var e=[],h,k,d,m;b;){h=0;for(k=b.children.length;h<k;h++)if(d=b.children[h],m=b.O?f(d):d,db(a,m))if(b.O)c.push(d);else if(a.s<=m.s&&a.u<=m.u&&m.A<=a.A&&m.B<=a.B){m=c;for(var l=[];d;)d.O?m.push.apply(m,d.children):l.push.apply(l,d.children),d=l.pop()}else e.push(d);b=e.pop()}return c},clear:function(){this.data=S([]);return this},a:function(a){return a},c:eb,h:fb,toJSON:function(){return this.data}};
function gb(a,b,c,f,e){b.children.sort(e);a=a.a.bind(a);e=T(b,0,c,a,void 0);var h=T(b,f-c,f,a,void 0),k=hb(e)+hb(h),d;for(d=c;d<f-c;d++){var m=b.children[d];U(e,b.O?a(m):m);k+=hb(e)}for(d=f-c-1;d>=c;d--)m=b.children[d],U(h,b.O?a(m):m),k+=hb(h);return k}function ib(a,b,c){a.data=S([b,c]);a.data.height=b.height+1;a.data.O=!1;V(a.data,a.a)}
function jb(a,b,c,f){var e=a.a.bind(a);f=f?b:e(b);e=[];for(var h,k=a.data,d=c,m,l,p,g,q,n,r;;){e.push(k);if(k.O||e.length-1===d)break;n=r=Infinity;m=0;for(l=k.children.length;m<l;m++)p=k.children[m],g=kb(p),q=(Math.max(p.A,f.A)-Math.min(p.s,f.s))*(Math.max(p.B,f.B)-Math.min(p.u,f.u))-g,q<r?(r=q,n=g<n?g:n,h=p):q===r&&g<n&&(n=g,h=p);k=h||k.children[0]}h=k;h.children.push(b);for(U(h,f);0<=c;)if(e[c].children.length>a.b){b=a;h=e;k=c;d=h[k];m=d.children.length;q=b.i;n=b;l=d;r=q;var u=m;p=l.O?n.c:eb;var t=
l.O?n.h:fb;g=gb(n,l,r,u,p);n=gb(n,l,r,u,t);g<n&&l.children.sort(p);l=void 0;p=b;g=d;t=m;n=m=Infinity;for(u=q;u<=t-q;u++){var y=T(g,0,u,p.a,void 0);var v=T(g,u,t,p.a,void 0);r=Math.max(0,Math.min(y.A,v.A)-Math.max(y.s,v.s))*Math.max(0,Math.min(y.B,v.B)-Math.max(y.u,v.u));v=kb(y)+kb(v);r<n?(n=r,l=u,m=v<m?v:m):r===n&&v<m&&(m=v,l=u)}m=l;m=S(d.children.splice(m,d.children.length-m));m.height=d.height;m.O=d.O;V(d,b.a);V(m,b.a);k?h[k-1].children.push(m):ib(b,d,m);c--}else break;for(a=c;0<=a;a--)U(e[a],f)}
function lb(a,b,c,f,e){var h=f-c+1,k=a.b;if(h<=k){var d=S(b.slice(c,f+1));V(d,a.a);return d}e||(e=Math.ceil(Math.log(h)/Math.log(k)),k=Math.ceil(h/Math.pow(k,e-1)));d=S([]);d.O=!1;d.height=e;h=Math.ceil(h/k);k=h*Math.ceil(Math.sqrt(k));var m;for(mb(b,c,f,k,a.c);c<=f;c+=k){var l=Math.min(c+k-1,f);mb(b,c,l,h,a.h);for(m=c;m<=l;m+=h){var p=Math.min(m+h-1,l);d.children.push(lb(a,b,m,p,e-1))}}V(d,a.a);return d}
function nb(a,b){if(b&&b.length)if(b.length<a.i)for(var c=0,f=b.length;c<f;c++){var e=b[c];e&&jb(a,e,a.data.height-1,!1)}else b=lb(a,b.slice(),0,b.length-1,0),a.data.children.length?a.data.height===b.height?ib(a,a.data,b):(a.data.height<b.height&&(c=a.data,a.data=b,b=c),jb(a,b,a.data.height-b.height-1,!0)):a.data=b}function V(a,b){T(a,0,a.children.length,b,a)}
function T(a,b,c,f,e){e||(e=S(null));e.s=Infinity;e.u=Infinity;e.A=-Infinity;e.B=-Infinity;for(var h;b<c;b++)h=a.children[b],U(e,a.O?f(h):h);return e}function U(a,b){a.s=Math.min(a.s,b.s);a.u=Math.min(a.u,b.u);a.A=Math.max(a.A,b.A);a.B=Math.max(a.B,b.B)}function eb(a,b){return a.s-b.s}function fb(a,b){return a.u-b.u}function kb(a){return(a.A-a.s)*(a.B-a.u)}function hb(a){return a.A-a.s+(a.B-a.u)}function db(a,b){return b.s<=a.A&&b.u<=a.B&&b.A>=a.s&&b.B>=a.u}
function S(a){return{children:a,height:1,O:!0,s:Infinity,u:Infinity,A:-Infinity,B:-Infinity}}function mb(a,b,c,f,e){for(var h=[b,c],k;h.length;)c=h.pop(),b=h.pop(),c-b<=f||(k=b+Math.ceil((c-b)/f/2)*f,ab(a,k,b,c,e),h.push(b,k,k,c))};function ob(a){function b(a,b){b=b.qb();Xa(k,0);for(var h=0;h<b.length&&0>b[h][1];)h++;var g=d.getContext("2d");g.font=c+"px sans-serif";g.fillStyle="rgba(0, 0, 0, 1.0)";g.textBaseline="bottom";if(h<b.length)for(var l=b[h],m=l[1],r=0;;){if(void 0===l||l[1]!==m){m=Math.floor(m/e);var u=new Uint8Array(g.getImageData(0,0,f,c).data.buffer);g.clearRect(0,0,f,c);for(var t=3;t<u.length;t+=4)k[m+r]=u[t],r+=4;r>=f*e*4&&(r=0);if(void 0!==l)m=l[1];else break}for(;h<b.length&&l[1]===m;)g.fillText(a[l[2]],l[0]+
1,c),h++,l=b[h]}return k}var c=a.Ub,f=a.Tb,e=a.Sb,h=new Ta(c);if(e%c)throw"Label canvas height must be a multiple of font height for now.";a=new ArrayBuffer(f*e*4);var k=new Uint8Array(a),d=document.createElement("canvas");d.width=f;d.height=c;this.b=function(a){var d=0,k=[];a.sort(function(a,b){return(b.labelPriority||0)-(a.labelPriority||0)});var g=a.reduce(function(a,b){b=J(b.label.split(/\s+/));for(var c=b.next();!c.done;c=b.next())c=c.value,void 0===a["#"+c]&&(k.push(c),a["#"+c]=d++);return a},
{}),m=k.map(function(a){return h.a(a)}),n=m.reduce(function(a,b,c){a["#"+k[c]]=b;return a},{"# ":h.a(" ")}),r=$a(c,k,m,f,4*e),u=b(k,r),t=new Va(c,n),y=[];a.forEach(function(a,b){t.a(a.label.split(/\s+/),function(a,c){a.reduce(function(a,b){return a&&void 0!==r.$a(g["#"+b])},!0)&&t.b(a,c,function(a,c,d,e,f){y.push([a,c,g["#"+f],b])})})});return{hc:k,ec:m,Rb:y,cc:r,dc:u}};this.a=function(a,b,d,g,e){function f(b,c){var g=h[b].la;if(!m[g]){b=c.search(h[b]);c=a[g].labelPriority;if(0>=c)for(var d=0;d<b.length;d++){var e=
b[d].la;if(e!==g&&a[e].labelPriority>c){m[g]=1;return}}for(c=0;c<b.length;c++)d=b[c].la,d!==g&&(m[d]=1)}}d=d.I/g;g=c;for(var h=[],k=0;k<b.length;k++)h.push({s:0,A:0,u:0,B:0,la:b[k][3]});k=new Float32Array(a.length);Xa(k,Infinity);for(var l=a.length,m=new Uint8Array(a.length),p=1,q=Math.pow(2,.25);4096>=p&&0<l;){for(var x=d/p,w=.5*c*(1+(.25-.2*Math.min(1,Math.log(p)*Math.LOG2E/4))),A=0;A<b.length;A++){var B=b[A],C=a[B[3]],D=h[A],G=e[B[2]];D.s=(B[0]-w)*x+C.x;D.u=(B[1]-w)*x+C.y;D.A=(B[0]+w+G)*x+C.x;
D.B=(B[1]+w+g)*x+C.y}x=new cb;nb(x,h);Xa(m,0);for(w=0;w<h.length;w++)Infinity!==k[h[w].la]&&f(w,x);for(w=0;w<h.length;w++)Infinity===k[h[w].la]&&f(w,x);for(x=0;x<m.length;x++)m[x]||Infinity!==k[x]||(k[x]=p,l--);p*=q}return k}};function pb(a,b){function c(a){var b=new Int8Array(8),c=0;b[c++]=0;b[c++]=0;b[c++]=1;b[c++]=0;b[c++]=1;b[c++]=1;b[c++]=0;b[c]=1;a.setData(b,2,4)}function f(a,b,c){for(var g=new Float32Array(3*a.length),d=0,e=0;e<a.length;e++){var f=a[e],h=c[f[2]];g[d++]=f[0];g[d++]=f[1];g[d++]=h}b.setData(g,3,a.length)}function e(a,b,c){for(var g=new Int16Array(3*a.length),d=0,e=0;e<a.length;e++){var f=b.$a(a[e][2]);g[d++]=f[0];g[d++]=f[1]%t;g[d++]=Math.floor(f[1]/t)}c.setData(g,3,a.length)}function h(a,b,c,g,d){for(var e=
new Uint8ClampedArray(b.length),f=0;f<b.length;f++){var h=a[b[f][3]][g];e[f]=255*(void 0!==h?h:d)}c.setData(e,1,b.length)}function k(a,b,c,g,d){for(var e=0,f=new Uint8ClampedArray(4*b.length),h=0;h<b.length;h++){var k=a[b[h][3]][g]||d;f[e++]=k[0];f[e++]=k[1];f[e++]=k[2];f[e++]=k[3]}c.setData(f,4,a.length)}function d(a,b){ja=y.a(v,z,a,pa,b);a=v;b=z;for(var c=ja,g=new Float32Array(3*b.length),d=0,e=0;e<b.length;e++){var f=b[e],h=a[f[3]];g[d++]=h.x;g[d++]=h.y;g[d++]=Math.min(1E6,c[f[3]])}I.setData(g,
3,b.length)}function m(){if(G){var a=G.I/pa;n.use(function(){n.f("uBoxScale",a)});q.use(function(){q.f("uBoxScale",a)})}}function l(){w&&(k(v,z,qa,"labelColor",[0,0,0,255]),w=!1)}function p(){A&&(h(v,z,W,"labelOpacity",1),A=!1)}var g=a.Z,q=a.createProgram({name:"labelBoxes",T:"\n      precision mediump float;\n      attribute vec2 aVertexPosition;\n      attribute vec3 aLabelPointData;\n      attribute vec3 aLabelBoxPositionData;\n      attribute float aLabelOpacity;\n      attribute vec4 aLabelBoxColor;\n      attribute float aLabelBoxOpacity;\n  \n      varying vec2 unitBoxCoord;\n      varying float boxWidth;\n      varying float visibilityScale;\n      varying float labelOpacity;\n      varying vec4 labelBoxColor;\n      varying float labelBoxOpacity;\n  \n      uniform mat3 uMvMatrix;\n      uniform float uScale;\n      uniform float uBoxScale;\n      uniform float uFontSize;\n      uniform float uBoxPadding;\n      \n      // The comment is to make IntelliJ parser happy\n      //\n    vec4 getGlPosition(vec2 unitBoxWithPadding, vec3 aLabelBoxPositionData, float uFontSize, mat3 uMvMatrix) {\n      // Scale to match the actual aspect ratio of the word    \n      vec2 boxAtOrigin = unitBoxWithPadding * vec2(aLabelBoxPositionData.z, uFontSize);\n      \n      // Position the word within the label and position in the point space\n      vec2 scaled = (boxAtOrigin + aLabelBoxPositionData.xy) * uBoxScale / uScale + aLabelPointData.xy;      \n      \n      // Transform through view matrix\n      vec3 transformed = uMvMatrix * vec3(scaled, 1.0);\n    \n      // We add the extra uScale for the label fade/in out animation \n      return vec4(\n        transformed.xy, \n        (\n          // scale-based visibility\n          2.0 * (step(uScale + uScale - aLabelPointData.z, 0.0)) +\n          \n          // per-label visibility, hide if label opacity == 0   \n          2.0 * step(aLabelOpacity, 0.0) +\n          \n          // Sort by visibility scale for the depth buffer fallback\n          smoothstep(-1.0, 1.0, log2(aLabelPointData.z) - log2(uScale * 2.0))                     \n        ),    \n        1.0\n      );\n    }\n  \n  \n      void main(void) {\n        // Transform the (0.0, 1.0) square to the origin-relative word box. We'll also apply some padding to the box.\n        // We want the padding to be equal along x and y, and because the only way to apply padding is to scale\n        // the box around origin, to keep the x/y paddings equal, we'll need separate scales on x and y axes. \n        // We also apply two corrective factors to: 1) render descenders partially on the padding (looks better) --\n        // this is done by shifting the scaling center slightly above the origin (the 0.67 instead of 0.5), \n        // 2) making the vertical padding smaller, the 0.7 factor.\n        vec2 unitBoxWithPadding = \n          (aVertexPosition - vec2(0.5, 0.67)) // make the square origin-relative\n            * vec2(1.0 + uBoxPadding * uFontSize / aLabelBoxPositionData.z, 1.0 + uBoxPadding * 0.7) // scale to add padding \n            + vec2(0.5, 0.67); // transform the box back to start at (0, 0) \n            \n        gl_Position = getGlPosition(unitBoxWithPadding, aLabelBoxPositionData, uFontSize, uMvMatrix);\n        \n        \n        unitBoxCoord = aVertexPosition;\n        boxWidth = aLabelBoxPositionData.z;\n        visibilityScale = aLabelPointData.z;\n        labelOpacity = aLabelOpacity;\n        labelBoxOpacity = aLabelBoxOpacity;\n        labelBoxColor = aLabelBoxColor;\n      }\n    ",
N:"\n      precision mediump float;\n      uniform float uScale;\n      uniform float uLabelOpacity;\n      uniform float uFontSize;\n      \n      varying float visibilityScale;\n      varying vec2 unitBoxCoord;\n      varying float boxWidth;\n      varying float labelOpacity;\n      varying vec4 labelBoxColor;\n      varying float labelBoxOpacity;\n      \n      float udRoundBox(vec2 p, vec2 b, float r) {\n        return length(max(abs(p) - b + r, 0.0)) - r;\n      }\n      \n      void main(void) {\n        float alpha = uLabelOpacity * smoothstep(-1.0, 0.0, 4.0 * (log2(uScale) - log2(visibilityScale)));\n      \n        // Distance field based rounded box\n        vec2 boxInScreenCoordinates = vec2(boxWidth, uFontSize);\n        float b = smoothstep(0.0, 1.0, udRoundBox(boxInScreenCoordinates * (unitBoxCoord * 2.0 - 1.0), 1.0 * boxInScreenCoordinates, 7.0));\n        \n        gl_FragColor = vec4(\n          1.0 - labelBoxColor.rgb,\n          labelBoxOpacity * labelOpacity * labelBoxColor.a * (1.0 - b)\n        ) * alpha;\n      }\n    ",
K:"aVertexPosition aLabelPointData aLabelBoxPositionData aLabelOpacity aLabelBoxColor aLabelBoxOpacity".split(" "),M:"uMvMatrix uScale uBoxScale uFontSize uBoxPadding uLabelOpacity".split(" ")}),n=a.createProgram({name:"labels",T:"\n      precision mediump float;\n      attribute vec2 aVertexPosition;\n      attribute vec3 aLabelPointData;\n      attribute vec3 aLabelBoxSpriteData;\n      attribute vec3 aLabelBoxPositionData;\n      attribute float aLabelOpacity;\n      attribute vec4 aLabelColor;\n  \n      varying vec3 labelBox;\n      varying vec2 boxCoord;\n      varying float visibilityScale;\n      varying vec4 labelColor;\n      varying float labelOpacity;\n  \n      uniform mat3 uMvMatrix;\n      uniform float uScale;\n      uniform float uBoxScale;\n      uniform float uFontSize;\n  \n      // The comment is to make IntelliJ parser happy\n      //\n    vec4 getGlPosition(vec2 unitBoxWithPadding, vec3 aLabelBoxPositionData, float uFontSize, mat3 uMvMatrix) {\n      // Scale to match the actual aspect ratio of the word    \n      vec2 boxAtOrigin = unitBoxWithPadding * vec2(aLabelBoxPositionData.z, uFontSize);\n      \n      // Position the word within the label and position in the point space\n      vec2 scaled = (boxAtOrigin + aLabelBoxPositionData.xy) * uBoxScale / uScale + aLabelPointData.xy;      \n      \n      // Transform through view matrix\n      vec3 transformed = uMvMatrix * vec3(scaled, 1.0);\n    \n      // We add the extra uScale for the label fade/in out animation \n      return vec4(\n        transformed.xy, \n        (\n          // scale-based visibility\n          2.0 * (step(uScale + uScale - aLabelPointData.z, 0.0)) +\n          \n          // per-label visibility, hide if label opacity == 0   \n          2.0 * step(aLabelOpacity, 0.0) +\n          \n          // Sort by visibility scale for the depth buffer fallback\n          smoothstep(-1.0, 1.0, log2(aLabelPointData.z) - log2(uScale * 2.0))                     \n        ),    \n        1.0\n      );\n    }\n  \n\n      void main(void) {\n        // Scale to match the actual aspect ratio of the word    \n        vec2 boxAtOrigin = aVertexPosition * vec2(aLabelBoxPositionData.z, uFontSize);\n        \n        gl_Position = getGlPosition(aVertexPosition, aLabelBoxPositionData, uFontSize, uMvMatrix);\n\n        labelBox = aLabelBoxSpriteData;\n        boxCoord = boxAtOrigin;\n        visibilityScale = aLabelPointData.z;\n        labelColor = aLabelColor;\n        labelOpacity = aLabelOpacity;\n      }\n    ",
N:"\n      precision mediump float;\n      uniform sampler2D uLabelSprites;\n      uniform float uScale;\n      uniform vec2 uTextureResolution;\n      uniform float uLabelOpacity;\n      \n      varying vec2 boxCoord;\n      varying vec3 labelBox;\n      varying float visibilityScale;\n      varying vec4 labelColor;\n      varying float labelOpacity;\n      \n      void main(void) {\n        vec4 pixel = texture2D(uLabelSprites, (2.0 * (labelBox.xy + boxCoord.xy) + 1.0) / (2.0 * uTextureResolution));\n        \n        // To avoid branching and thread divergence, we build a mask vector where the channel's corresponding\n        // value is 1.0 only if chanel number is 1.0, 2.0, 3.0 or 4.0, respectively.\n        float channel = floor(labelBox.z + 1.0);\n        vec4 mask = vec4(\n          step(1.0, channel) * step(-1.0, -channel),        \n          step(2.0, channel) * step(-2.0, -channel),        \n          step(3.0, channel) * step(-3.0, -channel),       \n          step(4.0, channel) * step(-4.0, -channel)       \n        );\n        \n        // Select the right channel.\n        float p = dot(pixel, mask);\n        \n        gl_FragColor = vec4(\n          labelColor.rgb,\n          \n          // Fade in/out labels set to show at just a little above the current zoome scale\n          uLabelOpacity * labelOpacity * p * labelColor.a * smoothstep(-1.0, 0.0, 4.0 * (log2(uScale) - log2(visibilityScale)))\n        );\n      }\n    ",
K:"aVertexPosition aLabelPointData aLabelBoxSpriteData aLabelBoxPositionData aLabelOpacity aLabelColor".split(" "),M:"uMvMatrix uScale uLabelSprites uBoxScale uTextureResolution uFontSize uLabelOpacity".split(" ")}),r=Math.ceil(16*b),u=128*r,t=128*r,y=new ob({Ub:r,Tb:u,Sb:t});n.use(function(){n.f("uFontSize",r);n.D("uTextureResolution",u,t)});q.use(function(){q.f("uFontSize",r);q.f("uBoxPadding",.5)});var v,z,x=!1,w=!0,A=!0,B=!0,C=!0,D,G,ja,ka,Aa=g.getExtension("EXT_blend_minmax"),la=!!Aa,ba=new Na(a,
!la),Ea=new Sa(a),N=a.createBuffer(),I=a.createBuffer(),na=a.createBuffer(),ha=a.createBuffer(),qa=a.createBuffer(),W=a.createBuffer(),ra=a.createBuffer(),sa=a.createBuffer(),X,ta=a.createFramebuffer(),M,Y,ua=new Oa(a),pa;this.R=function(b,c){pa=c;m();ua.b(b,c);ba.a(b,c);Ea.a(b,c);M&&M.release();M=a.createTexture(null,b,c,g.LINEAR,g.RGBA,g.UNSIGNED_BYTE);ta.use(function(){g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,M.W(),0)});Y&&Y.release();Y=a.createTexture(null,b,c,g.LINEAR,
g.RGBA,g.UNSIGNED_BYTE)};this.L=function(){A=!0};this.J=function(){w=!0};this.o=function(){C=!0};this.i=function(){B=!0};this.P=function(){x=!0};this.V=function(b,l){this.a(l);var m=y.b(b),p=m.Rb,n=m.ec,x=m.cc;m=m.dc;ka=b.reduce(function(a,b,c){a.set(b,c);return a},new Map);z=p;v=b;D=n;d(l,n);c(N);e(p,x,na);f(p,ha,n);k(b,p,qa,"labelColor",[0,0,0,255]);h(b,p,W,"labelOpacity",1);k(b,p,ra,"labelBoxColor",[242,217,166,127]);h(b,p,sa,"labelBoxOpacity",0);X&&X.release();X=a.createTexture(m,u,t,g.NEAREST,
g.RGBA,g.UNSIGNED_BYTE)};this.a=function(a){G=a;m()};this.S=function(a,c){if(0===I.m()||0===Z)return ta.use(function(){g.clearColor(0,0,0,0);g.clear(g.COLOR_BUFFER_BIT)}),M;x&&(d(G,D),x=!1);p();l();C&&(h(v,z,sa,"labelBoxOpacity",0),C=!1);B&&(k(v,z,ra,"labelBoxColor",[242,217,166,127]),B=!1);ta.use(function(){g.clearColor(0,0,0,0);g.clear(g.COLOR_BUFFER_BIT);n.use(function(){n.g("aVertexPosition",N,g.BYTE);n.g("aLabelPointData",I,g.FLOAT,!1,0,0,!0);n.g("aLabelBoxSpriteData",na,g.SHORT,!1,0,0,!0);n.g("aLabelBoxPositionData",
ha,g.FLOAT,!1,0,0,!0);n.g("aLabelOpacity",W,g.UNSIGNED_BYTE,!0,0,0,!0);n.v("uLabelSprites",X,0);n.f("uScale",c);n.ga(a);n.G(["aVertexPosition","aLabelPointData","aLabelBoxSpriteData","aLabelBoxPositionData","aLabelOpacity"]);n.qa(I.m(),N.m())})});ua.a(M,M,2,Math.min(1,b/2));return M};this.U=function(a,c){0!==I.m()&&0!==Z&&(p(),l(),x&&(d(G,D),x=!1),ba.capture(function(){g.clearColor(0,0,0,0);g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT);q.use(function(){q.g("aVertexPosition",N,g.BYTE);q.g("aLabelPointData",
I,g.FLOAT,!1,0,0,!0);q.g("aLabelBoxPositionData",ha,g.FLOAT,!1,0,0,!0);q.g("aLabelOpacity",W,g.UNSIGNED_BYTE,!0,0,0,!0);q.g("aLabelBoxColor",ra,g.UNSIGNED_BYTE,!0,0,0,!0);q.g("aLabelBoxOpacity",sa,g.UNSIGNED_BYTE,!0,0,0,!0);q.f("uScale",c);q.ga(a);q.G("aVertexPosition aLabelPointData aLabelBoxPositionData aLabelOpacity aLabelBoxColor aLabelBoxOpacity".split(" "));la?(g.enable(g.BLEND),g.blendFuncSeparate(g.ONE,g.ONE,g.ONE,g.ONE),g.blendEquation(Aa.MAX_EXT)):(g.enable(g.DEPTH_TEST),g.disable(g.BLEND));
q.qa(I.m(),N.m())})}),ua.a(ba.W(),Y,1,Math.min(1,b/2)),la||g.disable(g.DEPTH_TEST),g.enable(g.BLEND),g.blendEquation(g.FUNC_ADD),g.blendFuncSeparate(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA,g.ONE,g.ONE_MINUS_SRC_ALPHA),Ea.U(ba.W(),Y,6),n.use(function(){n.g("aVertexPosition",N,g.BYTE);n.g("aLabelPointData",I,g.FLOAT,!1,0,0,!0);n.g("aLabelBoxSpriteData",na,g.SHORT,!1,0,0,!0);n.g("aLabelBoxPositionData",ha,g.FLOAT,!1,0,0,!0);n.g("aLabelColor",qa,g.UNSIGNED_BYTE,!0,0,0,!0);n.g("aLabelOpacity",W,g.UNSIGNED_BYTE,
!0,0,0,!0);n.v("uLabelSprites",X,0);n.f("uScale",c);n.ga(a);n.G("aVertexPosition aLabelPointData aLabelBoxSpriteData aLabelBoxPositionData aLabelOpacity aLabelColor".split(" "));g.enable(g.BLEND);g.blendEquation(g.FUNC_ADD);g.blendFuncSeparate(g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA,g.ONE,g.ONE_MINUS_SRC_ALPHA);n.qa(I.m(),N.m())}))};var Z=1;this.c=function(){return Z};this.b=function(a){Z=a;n.use(function(){n.f("uLabelOpacity",a)});q.use(function(){q.f("uLabelOpacity",a)})};this.b(Z);this.h=function(a,
b){return ka.has(a)?ja[ka.get(a)]<=b:!1}};function qb(a){function b(){var a=document.createElement("canvas");a.width=280*h;a.height=45*h;var b=a.getContext("2d");b.scale(.5*h,.5*h);b.save();b.transform(1,0,0,1,-90.6,-68.4);b.fillStyle="rgba(29, 53, 87, 0.75)";b.beginPath();b.moveTo(260.8,68.6);b.lineTo(260.8,158.3);b.lineTo(244,158.3);b.lineTo(244,153.5);b.bezierCurveTo(239.6,156.7,235.2,158.3,230.9,158.3);b.bezierCurveTo(221.7,158.3,214.4,155.3,209,149.3);b.bezierCurveTo(203.6,143.3,200.9,136.4,200.9,128.4);b.bezierCurveTo(200.9,120.4,203.6,
113.4,209,107.4);b.bezierCurveTo(214.4,101.4,221.7,98.4,230.9,98.4);b.bezierCurveTo(236.9,98.8,241.2,100.4,244,103.3);b.lineTo(244,68.5);b.moveTo(244,133.8);b.lineTo(244,124.1);b.bezierCurveTo(243.2,117.4,239.1,113.4,231.5,112.3);b.bezierCurveTo(221.9,113,216.5,118,215.3,127.2);b.bezierCurveTo(215.7,138.3,221.1,144.1,231.5,144.5);b.bezierCurveTo(239.1,143.3,243.2,139.7,244,133.8);b.fill();b.beginPath();b.moveTo(298.7,158.9);b.bezierCurveTo(290,158.9,282.7,156,276.9,150.1);b.bezierCurveTo(271,144.3,
268.1,137,268.1,128.4);b.bezierCurveTo(268.1,119.7,271,112.4,276.9,106.6);b.bezierCurveTo(282.7,100.7,290,97.8,298.7,97.8);b.bezierCurveTo(307.4,97.8,314.6,100.7,320.4,106.6);b.bezierCurveTo(326.3,112.4,329.2,119.7,329.2,128.4);b.bezierCurveTo(329.2,137.1,326.3,144.3,320.4,150.2);b.bezierCurveTo(314.6,156,307.4,158.9,298.7,158.9);b.moveTo(298.6,144.4);b.bezierCurveTo(303.1,144.4,306.8,142.9,309.7,139.8);b.bezierCurveTo(312.5,136.8,313.9,133,313.9,128.4);b.bezierCurveTo(313.9,123.9,312.5,120.1,309.7,
117);b.bezierCurveTo(306.8,113.9,303.1,112.4,298.5,112.4);b.bezierCurveTo(294,112.4,290.4,113.9,287.5,117);b.bezierCurveTo(284.7,120.1,283.3,123.9,283.3,128.4);b.bezierCurveTo(283.3,133,284.7,136.8,287.5,139.8);b.bezierCurveTo(290.4,142.9,294,144.4,298.6,144.4);b.fill();b.beginPath();b.moveTo(373.5,155.5);b.bezierCurveTo(370.6,157.4,367.3,158.3,363.6,158.3);b.bezierCurveTo(356.8,158.3,351.5,156.4,347.5,152.6);b.bezierCurveTo(343.5,148.8,341.5,143.9,341.5,137.9);b.lineTo(341.5,112);b.lineTo(332.5,
112);b.lineTo(332.5,98.5);b.lineTo(341.5,98.5);b.lineTo(341.5,82.3);b.lineTo(358.3,80.5);b.lineTo(358.3,98.5);b.lineTo(367.3,98.5);b.lineTo(367.3,112);b.lineTo(358.3,112);b.lineTo(358.3,135.6);b.bezierCurveTo(358.3,138.7,359,141,360.3,142.3);b.bezierCurveTo(361.6,143.6,363.4,144.2,365.5,144.2);b.bezierCurveTo(366.1,144.2,367.6,144,370,143.5);b.fill();b.beginPath();b.moveTo(376.4,158.3);b.lineTo(412.3,68.5);b.lineTo(430.3,68.5);b.lineTo(466.1,158.2);b.lineTo(447,158.3);b.lineTo(441.6,144.5);b.lineTo(400.9,
144.5);b.lineTo(395.5,158.3);b.moveTo(421.8,92.4);b.lineTo(408.1,126.6);b.lineTo(435.1,126.6);b.fill();b.beginPath();b.moveTo(503.1,155.5);b.bezierCurveTo(500.2,157.4,496.9,158.3,493.2,158.3);b.bezierCurveTo(486.4,158.3,481.1,156.4,477.1,152.6);b.bezierCurveTo(473.1,148.8,471.1,143.9,471.1,137.9);b.lineTo(471.1,112);b.lineTo(462.1,112);b.lineTo(462.1,98.5);b.lineTo(471.1,98.5);b.lineTo(471.1,82.3);b.lineTo(487.9,80.5);b.lineTo(487.9,98.5);b.lineTo(496.9,98.5);b.lineTo(496.9,112);b.lineTo(487.9,112);
b.lineTo(487.9,135.6);b.bezierCurveTo(487.9,138.7,488.6,141,489.9,142.3);b.bezierCurveTo(491.2,143.6,493,144.2,495.1,144.2);b.bezierCurveTo(495.7,144.2,497.2,144,499.6,143.5);b.fill();b.beginPath();b.moveTo(513.3,158.3);b.lineTo(513.3,68.5);b.lineTo(530.1,68.5);b.lineTo(530.1,158.3);b.fill();b.beginPath();b.moveTo(544.7,105.6);b.bezierCurveTo(552.3,100.8,561.1,98.4,571.1,98.4);b.bezierCurveTo(578.3,98.4,583.9,100.4,588.1,104.4);b.bezierCurveTo(592.3,108.4,594.4,114.4,594.4,122.4);b.lineTo(594.4,158.3);
b.lineTo(577.7,158.3);b.lineTo(577.7,153.5);b.bezierCurveTo(572.8,156.7,568.4,158.3,564.5,158.3);b.bezierCurveTo(556.5,158.3,550.5,156.6,546.5,153.2);b.bezierCurveTo(542.5,149.8,540.5,145.1,540.5,139.1);b.bezierCurveTo(540.5,133.6,542.4,128.6,546.2,124.2);b.bezierCurveTo(550,119.8,556.1,117.6,564.5,117.6);b.bezierCurveTo(568.4,117.6,572.8,118.8,577.7,121.2);b.lineTo(577.7,119.4);b.bezierCurveTo(577.6,115,574.4,112.6,568.1,112.2);b.bezierCurveTo(560.9,112.2,555.3,113.4,551.3,115.8);b.moveTo(577.7,
140.3);b.lineTo(577.7,133.6);b.bezierCurveTo(576.1,130.5,572.3,129,566.3,129);b.bezierCurveTo(559.1,129.8,555.3,132.6,554.9,137.3);b.bezierCurveTo(555.3,142.1,559.1,144.7,566.3,145.1);b.bezierCurveTo(572.3,145.1,576.1,143.5,577.7,140.3);b.fill();b.beginPath();b.moveTo(626.2,98.1);b.bezierCurveTo(631.8,98.1,636.2,98.8,639.3,100.1);b.bezierCurveTo(642.4,101.5,645.3,103.5,648,106.2);b.lineTo(638.7,116.7);b.bezierCurveTo(636,113.5,632.6,111.8,628.5,111.8);b.bezierCurveTo(624.5,111.8,621.8,112.6,620.4,
114.1);b.bezierCurveTo(619.1,115.6,619.1,116.9,620.4,118.2);b.bezierCurveTo(621.8,119.4,624.5,120.4,628.5,121.2);b.bezierCurveTo(634.5,121.7,639.3,123.4,643.1,126.3);b.bezierCurveTo(646.9,129.1,648.8,134,648.8,141.1);b.bezierCurveTo(648.8,146.7,646.6,151.1,642.1,154.2);b.bezierCurveTo(637.6,157.3,632.4,158.9,626.5,158.9);b.bezierCurveTo(620.8,158.9,616.1,158.1,612.3,156.5);b.bezierCurveTo(608.5,154.9,605.3,152.7,602.6,150);b.lineTo(611.9,139.5);b.bezierCurveTo(614.6,142.7,618.8,144.6,624.5,145.1);
b.bezierCurveTo(629.1,145.1,632,144.4,633.4,142.9);b.bezierCurveTo(634.7,141.4,634.9,139.9,634,138.4);b.bezierCurveTo(633,136.9,629.9,135.9,624.5,135.4);b.bezierCurveTo(619.6,134.8,615.2,133.3,611.1,130.9);b.bezierCurveTo(607.1,128.4,605,123.9,605,117.1);b.bezierCurveTo(605,110.9,607.3,106.2,611.9,103);b.bezierCurveTo(616.6,99.7,621.3,98.1,626.2,98.1);b.fill();b.restore();for(var c=[.2,.5,1,1,.2,.2,1,1,.5],d=0,e=0;3>e;e++)for(var f=0;3>f;f++)b.globalAlpha=c[d++],b.beginPath(),b.fillStyle="rgb(29, 53, 87)",
b.arc(14+31*f,14+31*e,14,0,2*Math.PI),b.fill();return a}var c=a.Z,f=a.createProgram({name:"dots",T:"\n      precision mediump float;\n      attribute vec2 aVertexPosition;\n\n      uniform mat3 uMvMatrix;\n      \n      varying vec2 position;\n  \n      void main(void) {\n        gl_Position = vec4(uMvMatrix * vec3(aVertexPosition.xy, 1.0), 1.0);\n        position = (aVertexPosition.xy + 1.0) / 2.0;\n      }\n    ",N:"\n      precision mediump float;\n      uniform sampler2D uLogo;\n      uniform vec2 uResolution;\n      varying vec2 position;\n\n      void main(void) {\n        vec4 pixel = texture2D(uLogo, position);\n        gl_FragColor = vec4(pixel.rgb, pixel.a);\n      }\n    ",
K:["aVertexPosition"],M:["uMvMatrix","uLogo","uResolution"]}),e,h,k,d=a.da(),m,l;this.b=function(a,b){m=a;l=b;a=.5*h;k=Q().scale(1,-1).translate((m-560*a/2-20*h)/m,(l-90*a/2-20*h)/l).scale(1/m,1/l).scale(560*a/2,90*a/2)};this.a=function(d){h=d;e&&e.release();e=a.Pa(b(),c.LINEAR)};this.U=function(){f.use(function(){f.g("aVertexPosition",d);f.G(["aVertexPosition"]);f.D("uResolution",560*h,90*h);f.ga(k.elements());f.v("uLogo",e,0);c.enable(c.BLEND);c.blendEquation(c.FUNC_ADD);c.blendFuncSeparate(c.SRC_ALPHA,
c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);f.Y(d.m())})}};function rb(a,b,c,f){var e=2*c,h,k,d,m;(function(){var c=Math.ceil(a/e),p=Math.ceil(b/e);h=c+8;k=p+8;d=c/f;m=p/f})();this.fb=function(){return f};this.eb=function(){return e};this.oa=function(){return h};this.na=function(){return k};this.width=function(){return d};this.height=function(){return m};this.margin=function(){return 8}};function sb(a,b){function c(){p=new rb(z,x,b,C);g.i(p);q.V(p)}function f(a,b){var c=g.P();0<D&&g.J();h.viewport(0,0,z,x);h.enable(h.BLEND);h.blendEquation(h.FUNC_ADD);h.blendFuncSeparate(h.SRC_ALPHA,h.ONE_MINUS_SRC_ALPHA,h.ONE,h.ONE_MINUS_SRC_ALPHA);h.clearColor(1,1,1,1);h.clear(h.COLOR_BUFFER_BIT);var d=t.S(a,b);0<D&&q.ka(g.L(),c,b,d);B.forEach(function(c){if(c.gb()){var e=c instanceof Qa?n:c instanceof Ra?r:void 0;e.U(c,a,b,d)}});t.U(a,b);u.U()}function e(a,c,d,e){var f=1+a*p.margin()/p.width();
a=1+a*p.margin()/p.height();return Q().translate(-(f-1),-(a-1)).scale(1,-1).translate(f-1,a-1).scale(2*b/z,2*b/x).translate(c/f,d/a).scale(z/(2*b),x/(2*b)).translate(-1,-1).scale(e,e).translate(1,1).translate(-1,-1).scale(2/(v.F*f),2/(v.I*a)).translate(-v.x,-v.y)}var h=a.Z;h.disable(h.DEPTH_TEST);var k=void 0,d=1,m=0,l=0,p,g=new Ia(a),q=new Ja(a);q.ia(b);var n=new Ka(a);n.i(b);var r=new Pa(a);r.b(b);var u=new qb(a);u.a(b);var t=new pb(a,b);h.getExtension("EXT_disjoint_timer_query");var y,v,z,x,w,
A,B;this.i=function(a,b){z=a;x=b;c();n.o(a,b);r.c(a,b);t.R(a,b);q.ja(a,b);u.b(a,b)};this.ta=function(b,c,d,e){v=b;y=d;w=new Map;A=new Map;B=c.filter(function(a){return void 0!==a.type}).map(function(b){switch(b.type){case "marker":var c=new Qa(b,a);w.set(b,c);return c;case "outline":return c=new Ra(b,a),A.set(b,c),c}});g.b(y);t.V(e,b)};this.b=function(a){v=a;t.a(a);g.S(e(1,0,0,1))};this.setTransform=function(a,b,c){d=c;m=a;l=b;k=e(0,a,b,c);g.V(e(1,a,b,c));f(k.elements(),d)};this.ca=function(){};this.a=
function(){f(k.elements(),d)};this.xa=function(){t.P()};this.wa=function(){t.L()};this.va=function(){t.J()};this.ua=function(){t.o()};this.ka=function(){t.i()};this.Ua=function(a){w.has(a)&&w.get(a).Ua()};this.Ra=function(a){w.has(a)&&w.get(a).Ra()};this.Sa=function(a){w.has(a)&&w.get(a).Sa()};this.sa=function(a){w.has(a)&&w.get(a).sa()};this.Ta=function(a){w.has(a)&&w.get(a).Ta()};this.Wa=function(a){A.has(a)&&A.get(a).Wa()};this.Na=function(){g.b(y)};this.getImageData=function(b){this.a();return a.canvas.toDataURL(P(b&&
b.format,"image/png"),P(b&&b.quality,.8))};this.ja=function(a){return t.h(a,d)};var C=2;this.J=function(){return C};this.Aa=function(a){C=a;c();this.setTransform(m,l,d)};this.V=function(){return g.c()};this.Ka=function(a){g.o(a)};this.ha=function(){return g.h()};this.La=function(a){g.a(a)};this.h=function(a){g.R(a)};this.h(.5);this.Fa=function(a){q.o(a)};var D=1;this.S=function(){return D};this.c=function(a){D=a;q.ha(a)};this.c(D);this.Ha=function(a){q.L(a)};this.Ga=function(a){q.J(a)};this.o=function(){return q.P()};
this.za=function(a){q.a(a)};this.ya=function(a){q.b(a)};this.R=function(){return q.S()};this.Da=function(a){q.h(a)};this.P=function(){return q.R()};this.Ca=function(a){q.c(a)};this.Ea=function(a){q.i(a)};this.L=function(){return t.c()};this.Ba=function(a){t.b(a)};this.ea=function(){return n.ea()};this.Ia=function(a){n.b(a)};this.ba=function(){return n.ba()};this.Ja=function(a){n.c(a);r.a(a)};this.ia=function(){return n.a()};this.Ma=function(a){n.h(a)}};function tb(a,b,c,f,e,h){if(!(e-f<=c)){var k=Math.floor((f+e)/2);ub(a,b,k,f,e,h%2);tb(a,b,c,f,k-1,h+1);tb(a,b,c,k+1,e,h+1)}}
function ub(a,b,c,f,e,h){for(;e>f;){if(600<e-f){var k=e-f+1,d=c-f+1,m=Math.log(k),l=.5*Math.exp(2*m/3);m=.5*Math.sqrt(m*l*(k-l)/k)*(0>d-k/2?-1:1);ub(a,b,c,Math.max(f,Math.floor(c-d*l/k+m)),Math.min(e,Math.floor(c+(k-d)*l/k+m)),h)}k=b[2*c+h];d=f;l=e;vb(a,b,f,c);for(b[2*e+h]>k&&vb(a,b,f,e);d<l;){vb(a,b,d,l);d++;for(l--;b[2*d+h]<k;)d++;for(;b[2*l+h]>k;)l--}b[2*f+h]===k?vb(a,b,f,l):(l++,vb(a,b,l,e));l<=c&&(f=l+1);c<=l&&(e=l-1)}}function vb(a,b,c,f){wb(a,c,f);wb(b,2*c,2*f);wb(b,2*c+1,2*f+1)}
function wb(a,b,c){var f=a[b];a[b]=a[c];a[c]=f};function xb(a,b,c,f,e,h){for(var k=[0,a.length-1,0],d=[],m=e*e;k.length;){var l=k.pop(),p=k.pop(),g=k.pop();if(p-g<=h)for(l=g;l<=p;l++){g=b[2*l]-c;var q=b[2*l+1]-f;g*g+q*q<=m&&d.push(a[l])}else{q=Math.floor((g+p)/2);var n=b[2*q],r=b[2*q+1],u=n-c,t=r-f;u*u+t*t<=m&&d.push(a[q]);u=(l+1)%2;if(0===l?c-e<=n:f-e<=r)k.push(g),k.push(q-1),k.push(u);if(0===l?c+e>=n:f+e>=r)k.push(q+1),k.push(p),k.push(u)}}return d};function yb(a,b,c,f,e){b=b||zb;c=c||Ab;e=e||Array;this.c=f||64;this.h=a;this.b=new e(a.length);this.a=new e(2*a.length);for(f=0;f<a.length;f++)this.b[f]=f,this.a[2*f]=b(a[f]),this.a[2*f+1]=c(a[f]);tb(this.b,this.a,this.c,0,this.b.length-1,0)}yb.prototype={};function zb(a){return a[0]}function Ab(a){return a[1]};function Bb(a){function b(a,b,c,d){b.x=c;b.y=d;b.ctrlKey=a.ctrlKey;b.altKey=a.altKey;b.shiftKey=a.shiftKey;return b}var c=a.X;a=a.Wb;var f,e={},h,k={},d,m={},l,p,g=1,q,n,r,u,t,y,v,z,x,w;this.R=function(a){x=a;z=x.points;v=new yb(z.map(function(a){return[a.x,a.y]}))};this.a=function(a){w=a;n=Q().translate(w.x,w.y).scale(w.F,w.I).scale(c/l,c/p);r=Q().scale(l/c,p/c).scale(1/w.F,1/w.I).translate(-w.x,-w.y)};this.b=function(a,b){l=a;p=b};this.L=function(a){f=a};this.P=function(a){h=a};this.S=function(a){d=
a};this.o=function(a){g=a};this.h=function(){return g};this.J=function(a){q=a};this.ca=function(){};this.setTransform=function(a,b,c){u=Q().multiply(n).scale(1/c,1/c).translate(-a,-b);t=Q().translate(a,b).scale(c,c).multiply(r);y=c};this.i=function(a,b){a=t.transform(a,b);return{x:a[0],y:a[1]}};this.c=function(a,b,c,d,e){function f(c,d){c=xb(v.b,v.a,c,d,k,v.c);if(c.length>=l){d=Math.min(1,50/c.length);for(var e=0;e<c.length;e++){var f=c[e];if(!m.has(f)){var g=z[f],p=a-g.x;g=b-g.y;p*p+g*g<h&&((1===
d||Math.random()<=d)&&x.push(f),n.push(f),m.add(f))}}}}var g=Math.min(w.F,w.I),h=Math.pow(g*e,2),k=g*c;c=xb(v.b,v.a,a,b,k,v.c).length;var l=Math.min(1,c)*d,m=new Set,n=[],x=[];for(f(a,b);0<x.length;)d=x.pop(),f(z[d].x,z[d].y);return n.map(function(a){return z[a]})};a.click(function(a){if(f){var c=u.transform(a.x,a.y);f(b(a,e,c[0],c[1]))}});var A=null;a.move(function(a){function e(c,e){e=b(a,m,e[0],e[1]);e.points=c.map(function(a){return z[a]});d(e)}if(d||h){var f=u.transform(a.x,a.y);h&&h(b(a,k,f[0],
f[1]));if(d){var n=xb(v.b,v.a,f[0],f[1],.5*c*g*q*(x.markerSizeMultiplier||1)*Math.min(Math.sqrt(y),4)*w.F/(y*l),v.c),p=n.reduce(function(a,b){var c=z[b],d=f[0]-c.x;c=f[1]-c.y;a.set(b,d*d+c*c);return a},new Map);n.sort(function(a,b){return p.get(a)-p.get(b)});if(null===A)0!==n.length&&(A=n,e(n,f));else if(n.length===A.length)for(var r=0;r<n.length;r++){if(n[r]!==A[r]){A=n;e(n,f);break}}else A=n,e(n,f)}}});a.Yb(function(a){h&&h(b(a,k,void 0,void 0))})};var xa=["OES_texture_float","OES_standard_derivatives","OES_texture_float_linear"];
function Cb(a){function b(){var a=k.clientWidth,b=k.clientHeight;if(0===a||0===b)throw"The provided element must have non-zero dimensions.";a*=e.X;b*=e.X;k.width=a;k.height=b;return{lb:a,kb:b}}function c(a){var b=va(a);1===a.length?b=b.hb(.5):0===a.length&&(b=new O(0,0,1,1));return b.Xb()}function f(a){a=a.layers||[];var b=0<a.length?a[0].points:[],d=c(b),e=b.filter(function(a){return void 0!==a.elevation}),f=b.filter(function(a){return void 0!==a.marker});b=b.filter(function(a){return void 0!==a.label});
return{pb:d,zb:e,fc:f,labels:b,Vb:a}}var e=Object.assign({},{element:null,X:window.devicePixelRatio||1,initialTransform:{translateX:0,translateY:0,scale:1}},a),h={points:[]},k=function(){var a=e.element;if(!a)throw"Provide a HTML element in which to embed dotAtlas.";var b=document.createElement("canvas");b.setAttribute("style","position: absolute; width: 100%; height: 100%; cursor: default");a.appendChild(b);return b}();a=b();var d=a.lb,m=a.kb;a=new wa(k);var l=new sb(a,e.X);l.i(d,m);a=new oa(e.element);
var p=new Bb({X:e.X,Wb:a});p.b(d,m);var g=new function(a){this.setTransform=function(b,c,d){for(var e=J(a),f=e.next();!f.done;f=e.next())f.value.setTransform(b,c,d)};this.ca=function(){for(var b=J(a),c=b.next();!c.done;c=b.next())c.value.ca()}}([l,p]),q=new ya,n=new Fa({$b:g,$:{j:e.initialTransform.translateX,l:e.initialTransform.translateY,scale:e.initialTransform.scale}},q),r=new Ga(n,a,q),u,t,y={points:[]};this.Ab=function(){return y};this.c=function(a){y=a;var b=f(y);a=b.pb;var c=b.zb,e=b.labels;
b=b.Vb;t=a.Va(d/m);u=a;p.R(b[0]||h);p.a(t);l.ta(t,b,c,e);l.b(t);n.setTransform(0,0,1);g.setTransform(0,0,1)};this.c(y);var v=!1;this.a=function(){v||(v=!0,window.requestAnimationFrame(function(){v=!1;l.a()}))};this.reset=function(a){n.reset(a)};this.yb=function(a,b,c,f){var g=t;n.c((d/2-c*(a-g.x)*d/g.F)/e.X,(m/2-c*(b-g.y)*m/g.I)/e.X,c,f)};this.za=function(){var a=b(),c=a.lb;a=a.kb;if(c-d||a-m){var f=u.Va(d/m),g=u.Va(c/a);t=g;n.a(c,a,d,m,g,f,e.X);l.b(g);l.i(c,a);p.b(c,a);p.a(g);n.ca();d=c;m=a}};this.tb=
function(a,b){switch(a){case "labelVisibilityScales":l.xa();break;case "labelOpacity":l.wa();break;case "labelColors":l.va();break;case "labelBoxOpacity":l.ua();break;case "labelBoxColors":l.ka();break;case "markers":l.Ua(b);break;case "outline":l.Wa(b);break;case "markerColors":l.Ra(b);break;case "markerOpacity":l.Sa(b);break;case "markerSizes":l.sa(b);break;case "markerTypes":l.Ta(b);break;case "elevations":l.Na()}};this.Bb=function(){return n.b().scale};this.getImageData=function(a){return l.getImageData(a)};
this.ua=function(){return l.V()};this.Na=function(a){l.Ka(a)};this.J=function(){return l.J()};this.Ca=function(a){l.Aa(a)};this.va=function(){return l.ha()};this.ta=function(a){l.La(a)};this.xa=function(){return.5};this.ob=function(a){l.h(a)};this.ha=function(){return 0};this.Ia=function(a){l.Fa(a)};this.ja=function(){return l.S()};this.Ka=function(a){l.c(a)};this.ka=function(){return 0};this.La=function(a){l.Ha(a)};this.ia=function(){return 0};this.Ja=function(a){l.Ga(a)};this.o=function(){return l.o()};
this.Ba=function(a){l.za(a)};this.i=function(){return.2};this.Aa=function(a){l.ya(a)};this.R=function(){return l.P()};this.Fa=function(a){l.Ca(a)};this.S=function(){return l.R()};this.Ga=function(a){l.Da(a)};this.V=function(){return.15};this.Ha=function(a){l.Ea(a)};this.P=function(){return l.L()};this.Ea=function(a){l.Ba(a)};this.ea=function(){return l.ea()};this.Ma=function(a){l.Ia(a)};this.ba=function(){return l.ba()};this.b=function(a){l.Ja(a);p.J(a)};this.b(this.ba());this.wa=function(){return l.ia()};
this.mb=function(a){l.Ma(a)};this.L=function(){return p.h()};this.Da=function(a){p.o(a)};this.ya=function(a,b){return p.i(a,b)};this.h=function(a,b,c,d,e){return p.c(a,b,c,d,e)};this.Nb=function(a){p.L(a)};this.Ob=function(a){p.P(a)};this.Pb=function(a){r.a(a)};this.Qb=function(a){p.S(a)};this.setTransform=function(a,b,c){l.setTransform(a,b,c)};var z={labelVisible:!1};this.rb=function(a){z.labelVisible=l.ja(a);return z}};function Db(a){var b=new Cb({element:a.element,X:a.pixelRatio||1});new ia(this,b,a,{options:{dataObject:{get:b.Ab,set:b.c},maxElevationPoints:{get:b.ua,set:b.Na},maxRadiusDivider:{get:b.va,set:b.ta},radiusPow:{get:b.xa,set:b.ob},mapBlockSize:{get:b.J,set:b.Ca},mapElevationOffset:{get:b.ha,set:b.Ia},mapOpacity:{get:b.ja,set:b.Ka},mapSaturation:{get:b.ka,set:b.La},mapLightness:{get:b.ia,set:b.Ja},mapContourWidth:{get:b.o,set:b.Ba},mapContourOpacity:{get:b.i,set:b.Aa},mapLightAltitude:{get:b.R,set:b.Fa},
mapLightAzimuth:{get:b.S,set:b.Ga},mapLightIntensity:{get:b.V,set:b.Ha},labelOpacity:{get:b.P,set:b.Ea},markerOpacity:{get:b.ea,set:b.Ma},markerSizeMultiplier:{get:b.ba,set:b.b},minAbsoluteMarkerSize:{get:b.wa,set:b.mb},hoverRadiusMultiplier:{get:b.L,set:b.Da}},Mb:{zoom:{get:b.Bb},imageData:{get:b.getImageData}},methods:{redraw:b.a,resize:b.za,pointToScreenSpace:b.ya,cluster:b.h,update:b.tb,centerPoint:b.yb,reset:b.reset,state:b.rb},ra:{onClick:b.Nb,onHover:b.Ob,onPointHover:b.Qb,onMouseWheel:b.Pb}});
b.setTransform(0,0,1);b.a()}Db.supported=function(){try{var a=document.createElement("canvas");if(!a)return console.error("dotAtlas requires HTML5 canvas support."),!1;var b=a.getContext("webgl")||a.getContext("experimental-webgl");if(!b)return console.error("dotAtlas requires WebGL support."),!1}catch(c){return!1}return!!b&&xa.reduce(function(a,f){var c=!!b.getExtension(f);c||console.error("dotAtlas requires the "+f+" WebGL extension support.");return a&&c},!0)};window.DotAtlas=Db;
}).call(this)
